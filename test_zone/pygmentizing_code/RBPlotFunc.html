<div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Plot and animation context setup/initialization for Rigid Body class</span>

<span class="sd">Created on Tue Nov 11 16:05:05 2014</span>

<span class="sd">@author: whymranderson.blogspot.tw</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;RB animation and draw functions called&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">FancyArrowPatch</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">proj3d</span>  <span class="c">#&lt;- uncomment this, you need this</span>

<span class="k">class</span> <span class="nc">Arrow3D</span><span class="p">(</span><span class="n">FancyArrowPatch</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">FancyArrowPatch</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verts3d</span> <span class="o">=</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="n">xs3d</span><span class="p">,</span> <span class="n">ys3d</span><span class="p">,</span> <span class="n">zs3d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verts3d</span>
        <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span> <span class="o">=</span> <span class="n">proj3d</span><span class="o">.</span><span class="n">proj_transform</span><span class="p">(</span><span class="n">xs3d</span><span class="p">,</span> <span class="n">ys3d</span><span class="p">,</span> <span class="n">zs3d</span><span class="p">,</span> <span class="n">renderer</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_positions</span><span class="p">((</span><span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ys</span><span class="p">[</span><span class="mi">0</span><span class="p">]),(</span><span class="n">xs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ys</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">FancyArrowPatch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>

<span class="n">polynum</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>   <span class="c"># indexing vertices of a closed rectangle</span>

<span class="k">def</span> <span class="nf">CK</span><span class="p">(</span><span class="n">rotvec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Cayley-Klein parameters. Important: the built rotation matrix is with its couterclockwise active sense.</span>
<span class="sd">    This is basically the Rodriguez rotation formula in a matric form.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotvec</span><span class="p">,</span><span class="n">rotvec</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">amp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">rotvec</span><span class="o">/</span><span class="n">amp</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span> <span class="o">=</span> <span class="n">axis</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="n">d</span><span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">d</span><span class="p">),</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">d</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">)],</span>
                     <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">d</span><span class="p">),</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="o">-</span><span class="n">d</span><span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">d</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)],</span>
                     <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">d</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">),</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">d</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">),</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="n">d</span><span class="o">*</span><span class="n">d</span><span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">ret</span>

<span class="k">def</span> <span class="nf">get111norm</span><span class="p">(</span><span class="n">xyzaxes</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return array of body (1,1,1) unit vector as a function of time N in size (N,3)</span>
<span class="sd">    &#39;&#39;&#39;</span>    
    <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xyzaxes</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">vecnorm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]))])</span>    
    <span class="k">return</span> <span class="n">vecnorm</span>

<span class="k">def</span> <span class="nf">CalDiffInDeg</span><span class="p">(</span><span class="n">cordvec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Calculate and return angle difference between A and B method&#39;s 111 unit vectors&#39;&#39;&#39;</span>
    <span class="n">DCM111norm</span> <span class="o">=</span> <span class="n">get111norm</span><span class="p">(</span><span class="n">cordvec</span><span class="p">[:,:,:</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">Has111norm</span> <span class="o">=</span> <span class="n">get111norm</span><span class="p">(</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">7</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">DCM111norm</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Has111norm</span><span class="p">))</span>
    <span class="n">diffindeg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DCM111norm</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span><span class="n">Has111norm</span><span class="p">[</span><span class="n">i</span><span class="p">,:]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DCM111norm</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span>
<span class="c">#    print(np.shape(diffindeg))</span>
    <span class="k">return</span> <span class="n">diffindeg</span>

<span class="k">def</span> <span class="nf">CalDiffInDegBC</span><span class="p">(</span><span class="n">cordvec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Calculate and return angle difference between B and C method&#39;s 111 unit vectors&#39;&#39;&#39;</span>
    <span class="n">dDCM111norm</span> <span class="o">=</span> <span class="n">get111norm</span><span class="p">(</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">10</span><span class="p">:</span><span class="mi">13</span><span class="p">])</span>
    <span class="n">Has111norm</span> <span class="o">=</span> <span class="n">get111norm</span><span class="p">(</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">7</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">dDCM111norm</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Has111norm</span><span class="p">))</span>
    <span class="n">BCdiffindeg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dDCM111norm</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span><span class="n">Has111norm</span><span class="p">[</span><span class="n">i</span><span class="p">,:]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dDCM111norm</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span>
    <span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">BCdiffindeg</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">BCdiffindeg</span>

<span class="k">def</span> <span class="nf">getPlotAnimationLines</span><span class="p">(</span><span class="n">RBO</span><span class="p">):</span>
    <span class="c"># no use. &#39;&#39;&#39;Construct and return the line animation data sequence in a rigid body object for 3D animation&#39;&#39;&#39;</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">AlineCMxAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">AlineCMyAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">AlineCMzAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">RBO</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]])</span>    
    <span class="n">RBO</span><span class="o">.</span><span class="n">SquareEdge3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">4</span><span class="p">]])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">SquareEdge4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">4</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">5</span><span class="p">]])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">SquareEdge5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">5</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">]])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">SquareEdge6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">]])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">BlineCMxAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">9</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">7</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">9</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">BlineCMyAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">9</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">8</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">9</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">BlineCMzAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">RBO</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">9</span><span class="p">]])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">lineLData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">RBO</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">RBO</span><span class="o">.</span><span class="n">L_plot</span><span class="p">])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">w_bnormData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">RBO</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">RBO</span><span class="o">.</span><span class="n">w_lab_norm</span><span class="p">])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">ClineCMxAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">12</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">10</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">12</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">ClineCMyAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">12</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">11</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">12</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">ClineCMzAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">RBO</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">12</span><span class="p">]])</span>


<span class="n">sphere_color</span> <span class="o">=</span> <span class="s">&#39;lightgray&#39;</span><span class="c">#&#39;#FFDDDD&#39;</span>
<span class="n">sphere_alpha</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">frame_color</span> <span class="o">=</span> <span class="s">&#39;darkgray&#39;</span>
<span class="n">frame_alpha</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">frame_width</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">sphere_grid</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">wirestride</span> <span class="o">=</span> <span class="mi">4</span> <span class="c"># this affects the drawing speed, if less than 4</span>

<span class="k">def</span> <span class="nf">plot_lucid_sphere</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;plot the lucid sphere&#39;&#39;&#39;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sphere_grid</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">sphere_grid</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">u</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="n">sphere_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                           <span class="n">alpha</span><span class="o">=</span><span class="n">sphere_alpha</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="n">sphere_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                           <span class="n">alpha</span><span class="o">=</span><span class="n">sphere_alpha</span><span class="p">)</span>

    <span class="c"># wireframe</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="n">wirestride</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="n">wirestride</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="n">frame_color</span><span class="p">,</span>
                             <span class="n">alpha</span><span class="o">=</span><span class="n">frame_alpha</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="n">wirestride</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="n">wirestride</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="n">frame_color</span><span class="p">,</span>
                             <span class="n">alpha</span><span class="o">=</span><span class="n">frame_alpha</span><span class="p">)</span>
<span class="c">#    # equator</span>
<span class="c">#    axes.plot(1.0 * np.cos(u), 1.0 * np.sin(u),</span>
<span class="c">#                   zs=0, zdir=&#39;z&#39;, lw=frame_width,</span>
<span class="c">#                   color=frame_color)</span>
<span class="c">#    axes.plot(1.0 * np.cos(u), 1.0 * np.sin(u),</span>
<span class="c">#                   zs=0, zdir=&#39;x&#39;, lw=frame_width,</span>
<span class="c">#                   color=frame_color)</span>


<span class="k">def</span> <span class="nf">plot_support_bar</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;plot the support bar and disk&#39;&#39;&#39;</span>
    <span class="n">support_disk_radius</span> <span class="o">=</span> <span class="mf">0.2</span>  
    <span class="n">support_bar_length</span> <span class="o">=</span> <span class="mf">0.8</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="n">support_bar_length</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39;g-&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">ud</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sphere_grid</span><span class="p">)</span>
    <span class="n">vd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">sphere_grid</span><span class="p">)</span>
    <span class="n">xd</span> <span class="o">=</span> <span class="n">support_disk_radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ud</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">vd</span><span class="p">))</span>
    <span class="n">yd</span> <span class="o">=</span> <span class="n">support_disk_radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ud</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">vd</span><span class="p">))</span>
    <span class="n">zd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ud</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">vd</span><span class="p">)))</span><span class="o">-</span><span class="n">support_bar_length</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">xd</span><span class="p">,</span> <span class="n">yd</span><span class="p">,</span> <span class="n">zd</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                           <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="o">-</span><span class="n">xd</span><span class="p">,</span> <span class="o">-</span><span class="n">yd</span><span class="p">,</span> <span class="n">zd</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                           <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_xy_plane</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;plot the xy plane&#39;&#39;&#39;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sphere_grid</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">sphere_grid</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">u</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="n">sphere_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                           <span class="n">alpha</span><span class="o">=</span><span class="n">sphere_alpha</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="n">sphere_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                           <span class="n">alpha</span><span class="o">=</span><span class="n">sphere_alpha</span><span class="p">)</span>

    <span class="c"># wireframe</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="s">&#39;green&#39;</span><span class="p">,</span>
                             <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span><span class="c">#frame_alpha)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="s">&#39;green&#39;</span><span class="p">,</span>
                             <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span><span class="c">#frame_alpha)</span>

<span class="k">def</span> <span class="nf">update_line_multiple_segments</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">arg</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;3D Animation function. Take multiple segments line data.&#39;&#39;&#39;</span>
    <span class="n">arglen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="n">RBO</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cubeaf</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">construct_cube_4wires_method</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">display_ABC_cube</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">line3DObject</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">linei</span><span class="p">,</span><span class="n">lineid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">line3DObject</span><span class="p">,</span><span class="n">line3DObject</span><span class="p">):</span>
            <span class="n">linei</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">cubeaf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">],</span>
                           <span class="n">cubeaf</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">])</span>                 
            <span class="n">linei</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">(</span><span class="n">cubeaf</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">])</span>  
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="n">arglen</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">line3DObject</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">line3DData</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>   
        <span class="k">for</span> <span class="n">linei</span><span class="p">,</span><span class="n">lineid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">line3DObject</span><span class="p">,</span><span class="n">line3DObject</span><span class="p">):</span>
            <span class="n">linei</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="n">line3DData</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">line3DData</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span>
                           <span class="p">[</span><span class="n">line3DData</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">line3DData</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="mi">4</span><span class="p">]])</span>                 
            <span class="n">linei</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">([</span><span class="n">line3DData</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">line3DData</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="mi">5</span><span class="p">]])</span>  

<span class="k">def</span> <span class="nf">update_line_one_segments</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">arg</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;3D Animation function. Take one segment line data.&#39;&#39;&#39;</span>
    <span class="n">arglen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">arglen</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">line3DObject</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">line3DData</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>   
        <span class="k">for</span> <span class="n">linei</span><span class="p">,</span><span class="n">lineid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">line3DObject</span><span class="p">,</span><span class="n">line3DObject</span><span class="p">):</span>
            <span class="n">linei</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="n">line3DData</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">line3DData</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span>
                           <span class="p">[</span><span class="n">line3DData</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">line3DData</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="mi">4</span><span class="p">]])</span>                 
            <span class="n">linei</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">([</span><span class="n">line3DData</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">line3DData</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="mi">5</span><span class="p">]])</span> 

<span class="k">def</span> <span class="nf">InitFirstAnimationFrame</span><span class="p">(</span><span class="n">RBO</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">plt</span><span class="p">):</span>
    <span class="c"># no use. plot the initial body xyz axes DCM method</span>
    <span class="n">cordvec</span><span class="p">,</span><span class="n">Lzppnorm</span><span class="p">,</span><span class="n">L_plot</span><span class="p">,</span><span class="n">w_lab</span><span class="p">,</span><span class="n">w</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">Lzppnorm</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">L_plot</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">w_lab</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">w</span>
    <span class="c">#RBO.baxes = [ax.plot(*[ [0+cordvec[0,j,2]/2,(cordvec[0,j,i]+cordvec[0,j,2])/2] for j in range(3) ]) for i in range(3)]</span>
    <span class="c">#plt.setp(RBO.baxes[2],marker=&#39;o&#39;) #set z axis marker</span>
    <span class="c"># unpacking list to tuple and list comprehension, see below</span>
    <span class="c"># baxes[1]=ax.plot([0,cordvec[0,0,0]],[0,cordvec[0,1,0]],[0,cordvec[0,2,0]]), plot x axis line</span>

    <span class="c"># plot the initial body xyz axes from Hasbun&#39;s euler angle method</span>
    <span class="c">#RBO.baxes_hasbun = [ax.plot(*[ [0+cordvec[0,j,9]/2,(cordvec[0,j,i]+cordvec[0,j,9])/2] for j in range(3) ]) for i in range(7,10)]</span>
    <span class="c">#plt.setp(RBO.baxes_hasbun,linestyle=&#39;:&#39;) #set z axis marker</span>

    <span class="c"># Color of the rectangle</span>
    <span class="c">##</span>
    <span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="kn">as</span> <span class="nn">mplcm</span>
    <span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="kn">as</span> <span class="nn">colors</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">&#39;Oranges&#39;</span><span class="p">)</span>
    <span class="n">cNorm</span>  <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">scalarMap</span> <span class="o">=</span> <span class="n">mplcm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">cNorm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_color_cycle</span><span class="p">([</span><span class="n">scalarMap</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)])</span>
    <span class="c">##</span>
    <span class="c">#</span>

    <span class="c"># plot the initial square box</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    RBO.polylines = [ ax.plot(*[ [cordvec[0,j,polynum[i]],</span>
<span class="sd">                                  cordvec[0,j,polynum[i+1]]] for j in range(3) ]</span>
<span class="sd">                            ) for i in range(4) ]</span>
<span class="sd">    plt.setp(RBO.polylines,lw=5)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#change previous w(t_i-1) for w(t i-1) comparison</span>
    <span class="n">linetrace</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cordvec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">cordvec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">cordvec</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s">&#39;b-&#39;</span><span class="p">,</span>
                          <span class="n">markersize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;DCM with $\omega(t_i)$&#39;</span><span class="p">)</span>

    <span class="c">#lineLtrance=ax.plot(L_plot[:,0],L_plot[:,1],L_plot[:,2],&#39;k.&#39;,markersize=2)</span>
    <span class="c">#HasbunLtrance=ax.plot(Lzppnorm[:,0],Lzppnorm[:,1],Lzppnorm[:,2],&#39;k-&#39;,</span>
    <span class="c">#                 markersize=2,label=&#39;$\omega(t_{i+1})$ and Hasbun\&#39;s result&#39;)</span>
<span class="c">#    ax.legend()</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    RBO.lineL=ax.plot([0,L_plot[0,0]],</span>
<span class="sd">                  [0,L_plot[0,1]],</span>
<span class="sd">                  [0,L_plot[0,2]],&#39;k-&#39;)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#HasbunL=ax.plot([0,L_plot[0,0]],</span>
    <span class="c">#               [0,L_plot[0,1]],</span>
    <span class="c">#               [0,L_plot[0,2]],&#39;k-&#39;)</span>

    <span class="c"># plot angular velocity vector normalized to w(t0)--</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">w_lab_norm</span> <span class="o">=</span> <span class="n">w_lab</span><span class="o">/</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="c">#print(w[0,2],np.linalg.norm(w_lab[0,:]))</span>
    <span class="sd">&#39;&#39;&#39;    </span>
<span class="sd">    RBO.lineW=ax.plot([0,RBO.w_lab_norm[0,0]],</span>
<span class="sd">                  [0,RBO.w_lab_norm[0,1]],</span>
<span class="sd">                  [0,RBO.w_lab_norm[0,2]],&#39;g-&#39;)</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="c"># ----</span>

<span class="k">def</span> <span class="nf">Animation_Setup</span><span class="p">(</span><span class="n">RBO</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">plt</span><span class="p">,</span><span class="n">istep</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;DrawOption[&#39;name of observable&#39;]=True attributes will be read and corresponding</span>
<span class="sd">    vectors or trails of the observable will be collected. The animation sequence</span>
<span class="sd">    data are also contructed here.&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;xy_plane&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">plot_xy_plane</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        
    <span class="c"># plot the initial body xyz axes DCM method</span>
    <span class="n">cordvec</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span>
    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;A_axes&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">baxes</span> <span class="o">=</span><span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="p">[</span> <span class="p">[</span><span class="n">cordvec</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">cordvec</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="n">cordvec</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">cordvec</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">])]</span>
        <span class="c"># explaination for the above command: unpacking list to tuple and list comprehension, see next line</span>
        <span class="c"># baxes[1]=ax.plot([0,cordvec[0,0,0]],[0,cordvec[0,1,0]],[0,cordvec[0,2,0]]), plot x axis line</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">baxes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">)</span> <span class="c">#set z axis marker</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">AlineCMxAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">AlineCMyAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">AlineCMzAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">RBO</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">+</span> <span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">baxes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">AlineCMxAxis</span><span class="p">,</span>
                                       <span class="n">RBO</span><span class="o">.</span><span class="n">baxes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">AlineCMyAxis</span><span class="p">,</span>
                                        <span class="n">RBO</span><span class="o">.</span><span class="n">baxes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">AlineCMzAxis</span><span class="p">)</span>


    <span class="c"># plot the initial body xyz axes from Hasbun&#39;s euler angle method</span>
    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;B_axes&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">baxes_hasbun</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="n">cordvec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">9</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">cordvec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">cordvec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">)]</span> <span class="c"># see above example for understanding</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">baxes_hasbun</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">BlineCMxAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">9</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">7</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">9</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">BlineCMyAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">9</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">8</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">9</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">BlineCMzAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">RBO</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">9</span><span class="p">]])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">+</span> <span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">baxes_hasbun</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">BlineCMxAxis</span><span class="p">,</span>
            <span class="n">RBO</span><span class="o">.</span><span class="n">baxes_hasbun</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">BlineCMyAxis</span><span class="p">,</span>
            <span class="n">RBO</span><span class="o">.</span><span class="n">baxes_hasbun</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">BlineCMzAxis</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;C_axes&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">baxes_C</span> <span class="o">=</span><span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="p">[</span> <span class="p">[</span><span class="n">cordvec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">12</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">cordvec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">cordvec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">cordvec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">12</span><span class="p">]]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">])]</span>
<span class="c">#        RBO.baxes_C= [ax.plot(*[ [0+cordvec[0,j,12]/2,(cordvec[0,j,i]+cordvec[0,j,9])/2] for j in range(3) ]) for i in range(10,13)]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">baxes_C</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">ClineCMxAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">12</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">10</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">12</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">ClineCMyAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">12</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">11</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">12</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">ClineCMzAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">RBO</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">12</span><span class="p">]])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">+</span> <span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">baxes_C</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">ClineCMxAxis</span><span class="p">,</span>
            <span class="n">RBO</span><span class="o">.</span><span class="n">baxes_C</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">ClineCMyAxis</span><span class="p">,</span>
            <span class="n">RBO</span><span class="o">.</span><span class="n">baxes_C</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">ClineCMzAxis</span><span class="p">)</span>

    <span class="c"># Color of the rectangle</span>
    <span class="c">##</span>
    <span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="kn">as</span> <span class="nn">mplcm</span>
    <span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="kn">as</span> <span class="nn">colors</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">&#39;Oranges&#39;</span><span class="p">)</span>
    <span class="n">cNorm</span>  <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">scalarMap</span> <span class="o">=</span> <span class="n">mplcm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">cNorm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_color_cycle</span><span class="p">([</span><span class="n">scalarMap</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)])</span>
    <span class="c">##</span>
    <span class="c">#</span>

    <span class="c"># plot the initial square box</span>
    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;A_square&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">polylines</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="p">[</span> <span class="p">[</span><span class="n">cordvec</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">polynum</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                                      <span class="n">cordvec</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">polynum</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">]</span>
                                      <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">polylines</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">SquareEdge3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">4</span><span class="p">]])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">SquareEdge4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">4</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">5</span><span class="p">]])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">SquareEdge5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">5</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">]])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">SquareEdge6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">]])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span><span class="o">+</span> <span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">polylines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">SquareEdge3</span><span class="p">,</span>
                                        <span class="n">RBO</span><span class="o">.</span><span class="n">polylines</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">SquareEdge4</span><span class="p">,</span>
                                        <span class="n">RBO</span><span class="o">.</span><span class="n">polylines</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">SquareEdge5</span><span class="p">,</span>
                                        <span class="n">RBO</span><span class="o">.</span><span class="n">polylines</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">SquareEdge6</span><span class="p">)</span>

    <span class="c"># plot the initial cube</span>
    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;A_cube&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">display_ABC_cube</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">testout</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">construct_cube_4wires_method</span><span class="p">(</span><span class="n">istep</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">display_ABC_cube</span><span class="p">)</span>
        <span class="n">cubeinst1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">testout</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">cubeinst2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">testout</span><span class="p">[:,</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">cubeinst3</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">testout</span><span class="p">[:,</span><span class="mi">8</span><span class="p">:</span><span class="mi">12</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s">&#39;lightgray&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">cubeinst4</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">testout</span><span class="p">[:,</span><span class="mi">12</span><span class="p">:</span><span class="mi">16</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s">&#39;darkgray&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c">#RBPlot.plot_body_space_cone(ax4,b.cordvec[iframe,:,2],b.w_lab_norm[iframe,:],b.L_plot[iframe])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">cube_4_lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">cubeinst1</span><span class="p">,</span><span class="n">cubeinst2</span><span class="p">,</span><span class="n">cubeinst3</span><span class="p">,</span><span class="n">cubeinst4</span><span class="p">)</span>    

    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;B_cube&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">display_ABC_cube</span> <span class="o">=</span> <span class="mi">7</span>
    
        <span class="n">testout</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">construct_cube_4wires_method</span><span class="p">(</span><span class="n">istep</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">display_ABC_cube</span><span class="p">)</span>
        <span class="n">cubeinst1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">testout</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">cubeinst2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">testout</span><span class="p">[:,</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">cubeinst3</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">testout</span><span class="p">[:,</span><span class="mi">8</span><span class="p">:</span><span class="mi">12</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s">&#39;lightgray&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">cubeinst4</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">testout</span><span class="p">[:,</span><span class="mi">12</span><span class="p">:</span><span class="mi">16</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s">&#39;darkgray&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c">#RBPlot.plot_body_space_cone(ax4,b.cordvec[iframe,:,2],b.w_lab_norm[iframe,:],b.L_plot[iframe])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">cube_4_lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">cubeinst1</span><span class="p">,</span><span class="n">cubeinst2</span><span class="p">,</span><span class="n">cubeinst3</span><span class="p">,</span><span class="n">cubeinst4</span><span class="p">)</span>    

    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;C_cube&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">display_ABC_cube</span> <span class="o">=</span> <span class="mi">10</span>




    <span class="c">#change previous w(t_i-1) for w(t i-1) comparison</span>
    <span class="n">trailsamplerate</span> <span class="o">=</span> <span class="mi">1</span>    
    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;A_z_axis_trace&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">zlineAtrace</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cordvec</span><span class="p">[::</span><span class="n">trailsamplerate</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
                            <span class="n">cordvec</span><span class="p">[::</span><span class="n">trailsamplerate</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
                            <span class="n">cordvec</span><span class="p">[::</span><span class="n">trailsamplerate</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s">&#39;b-&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;A method with $\omega(t_{i+1})$ and B method&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;A_Angular Momentum Trace&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">lineLtrance</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">L_plot</span><span class="p">[::</span><span class="n">trailsamplerate</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">RBO</span><span class="o">.</span><span class="n">L_plot</span><span class="p">[::</span><span class="n">trailsamplerate</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">RBO</span><span class="o">.</span><span class="n">L_plot</span><span class="p">[::</span><span class="n">trailsamplerate</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
                            <span class="s">&#39;k-&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;B_z_axis_trace&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">Lzppnorm</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">Lzppnorm</span>
        <span class="n">HasbunZtrace</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Lzppnorm</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">Lzppnorm</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">Lzppnorm</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="s">&#39;k-&#39;</span><span class="p">,</span>
                     <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;$\omega(t_{i+1})$ and Hasbun</span><span class="se">\&#39;</span><span class="s">s result&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;B_Angular Momentum Trace&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">L_Bnorm</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">L_Bnorm</span>
        <span class="n">L_Btraceline</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">L_Bnorm</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">L_Bnorm</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">L_Bnorm</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="s">&#39;k.&#39;</span><span class="p">,</span>
                     <span class="n">markersize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;C_z_axis_trace&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">zlineCtrace</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cordvec</span><span class="p">[::</span><span class="n">trailsamplerate</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span>
                            <span class="n">cordvec</span><span class="p">[::</span><span class="n">trailsamplerate</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span>
                            <span class="n">cordvec</span><span class="p">[::</span><span class="n">trailsamplerate</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span><span class="s">&#39;g-&#39;</span><span class="p">,</span>
                          <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;C method&#39;</span><span class="p">)</span>
                     
<span class="c">#    ax.legend()</span>
    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;A_Angular Momentum Vec&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">L_plot</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">L_plot</span>
        
        <span class="n">RBO</span><span class="o">.</span><span class="n">lineL</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">L_plot</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
                          <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">L_plot</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span>
                          <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">L_plot</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span><span class="s">&#39;k-&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">)</span>
<span class="c">#        print RBO.lineL</span>
<span class="c">#        fanArrow3d=Arrow3D([0,L_plot[istep,0]],</span>
<span class="c">#                          [0,L_plot[istep,1]],</span>
<span class="c">#                          [0,L_plot[istep,2]],arrowstyle=&quot;-|&gt;&quot;, color=&quot;b&quot;)</span>
<span class="c">#        #RBO.lineL=ax.add_artist(fanArrow3d)</span>
<span class="c">#        print fanArrow3d</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">lineLAData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">RBO</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">RBO</span><span class="o">.</span><span class="n">L_plot</span><span class="p">])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">+</span> <span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">lineL</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">lineLAData</span><span class="p">)</span>        

    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;B_Angular Momentum Vec&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>    
        <span class="n">RBO</span><span class="o">.</span><span class="n">lineL</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">L_Bnorm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
                          <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">L_Bnorm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span>
                          <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">L_Bnorm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span><span class="s">&#39;r:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">)</span>
        <span class="c">#shape of L_Bnorm is (N,3), one vector less than N+1</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">lineLBData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">RBO</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">RBO</span><span class="o">.</span><span class="n">L_Bnorm</span><span class="p">])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">+</span> <span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">lineL</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">lineLBData</span><span class="p">)</span>

    <span class="c">#RBO.HasbunL=ax.plot([0,L_plot[0,0]],</span>
    <span class="c">#               [0,L_plot[0,1]],</span>
     <span class="c">#              [0,L_plot[0,2]],&#39;k-&#39;)</span>

    <span class="c"># plot angular velocity vector normalized to w(t0)--</span>
    <span class="c">#print(w[0,2],np.linalg.norm(w_lab[0,:]))</span>
    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;A_Angular Velocity Vec&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">w_lab_norm</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">w_lab</span><span class="o">/</span><span class="n">RBO</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">lineW</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">w_lab_norm</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
                          <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">w_lab_norm</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span>
                          <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">w_lab_norm</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span><span class="s">&#39;g-&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">w_bnormData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">RBO</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">RBO</span><span class="o">.</span><span class="n">w_lab_norm</span><span class="p">])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">+</span> <span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">lineW</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">w_bnormData</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;B_Angular Velocity Vector (normalized to t0 value)&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">w_lab_norm_hasbun</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">w_lab_hasbun</span><span class="o">/</span><span class="n">RBO</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">lineW</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">w_lab_norm_hasbun</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
                          <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">w_lab_norm_hasbun</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span>
                          <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">w_lab_norm_hasbun</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span><span class="s">&#39;m-&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">w_lab_hasbun_normData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">RBO</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">RBO</span><span class="o">.</span><span class="n">w_lab_norm_hasbun</span><span class="p">])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">+</span> <span class="p">(</span><span class="n">lineW</span><span class="p">,</span><span class="n">w_lab_hasbun_normData</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;B_contact_force_vector&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">draw_contact_force_vectors_diagram</span><span class="p">(</span><span class="n">RBO</span><span class="p">,</span><span class="n">istep</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;Torque_vector_A_method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">Tau_lab_A_method</span>
        <span class="n">start_of_vec</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">L_plot</span>
        <span class="n">end_of_vec</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">Tau_lab_A_method</span> <span class="o">+</span> <span class="n">RBO</span><span class="o">.</span><span class="n">L_plot</span>
        <span class="n">lineTau</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start_of_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">end_of_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
                        <span class="p">[</span><span class="n">start_of_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">end_of_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span>
                        <span class="p">[</span><span class="n">start_of_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">end_of_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span><span class="s">&#39;m-&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">tau_lab_A_method</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">start_of_vec</span><span class="p">,</span><span class="n">end_of_vec</span><span class="p">])</span>
        <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">+</span> <span class="p">(</span><span class="n">lineTau</span><span class="p">,</span><span class="n">tau_lab_A_method</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">mplot3d_animation</span><span class="p">(</span><span class="n">RBO</span><span class="p">,</span><span class="n">iframe</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Setup 3D window and prepare animation sequence from the solved</span>
<span class="sd">    rigid body object. Plot a lucid sphere and static istep-th keyframe as the </span>
<span class="sd">    initial frame as it is needed for mplot3D manager. Then call mplot3d </span>
<span class="sd">    funcanimation manager.&#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="kn">import</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">as</span> <span class="nn">p3</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">p3</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">RBO</span><span class="o">.</span><span class="n">view_overlook_angle</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="n">RBO</span><span class="o">.</span><span class="n">view_azim_angle</span><span class="p">)</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="mf">0.6</span>    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">factor</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="n">factor</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">factor</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="n">factor</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">factor</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="n">factor</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zticks</span><span class="p">([])</span>
    <span class="c">#ax.autoscale_view(tight=True, scalex=True, scaley=True, scalez=True)</span>
    <span class="n">plot_lucid_sphere</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plot_support_bar</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

    <span class="c">#AnimationFrameSetUp(RBO,ax,plt,iframe)</span>
    <span class="n">Animation_Setup</span><span class="p">(</span><span class="n">RBO</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">plt</span><span class="p">,</span><span class="n">iframe</span><span class="p">)</span>
    
    <span class="c">#uncomment here to save z motion for drawing gyro logo</span>
    <span class="c">#np.save(&#39;outfile&#39;, b.cordvec[::20,:20,2])</span>
    <span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="kn">as</span> <span class="nn">animation</span>
    
    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;A_cube&#39;</span><span class="p">]</span> <span class="o">|</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;B_cube&#39;</span><span class="p">]</span> <span class="o">|</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;C_cube&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">line_ani</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig2</span><span class="p">,</span> <span class="n">update_line_one_segments</span><span class="p">,</span> 
                                  <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">N</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">framerate</span><span class="p">)),</span>
                                  <span class="n">fargs</span><span class="o">=</span><span class="p">(</span><span class="n">RBO</span><span class="p">,)</span><span class="o">+</span> <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span><span class="p">,</span>
                                         <span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">repeat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line_ani</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig2</span><span class="p">,</span> <span class="n">update_line_multiple_segments</span><span class="p">,</span> 
                                  <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">N</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">framerate</span><span class="p">)),</span>
                                  <span class="n">fargs</span><span class="o">=</span><span class="p">(</span><span class="n">RBO</span><span class="p">,)</span><span class="o">+</span> <span class="n">RBO</span><span class="o">.</span><span class="n">cube_4_lines</span> <span class="o">+</span> <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span><span class="p">,</span>
                                         <span class="n">interval</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">repeat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">line_ani</span>


    
<span class="k">def</span> <span class="nf">draw_contact_force_vectors_diagram</span><span class="p">(</span><span class="n">RBO</span><span class="p">,</span><span class="n">istep</span><span class="p">,</span><span class="n">ax</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;animate the vectors of forces acting on gyro&#39;s center of mass&#39;&#39;&#39;</span>   
    <span class="n">max_amplitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="c">#exclude first and last value of F_cp due to boundary condition on derivative</span>
    <span class="k">print</span> <span class="n">max_amplitude</span>
    <span class="c">#plot contact force        </span>
    <span class="n">line_F_cp</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
                      <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span>
                      <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span><span class="s">&#39;b-&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">F_cp_normData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span><span class="mi">3</span><span class="p">)),</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="o">/</span><span class="n">max_amplitude</span><span class="p">])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">+</span> <span class="p">(</span><span class="n">line_F_cp</span><span class="p">,</span><span class="n">F_cp_normData</span><span class="p">)</span>
    <span class="c">#plot contact force vertical dash line     </span>
    <span class="n">line_F_cp_v</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
                        <span class="p">[</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span>
                        <span class="p">[</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="mi">0</span>                <span class="p">],</span><span class="s">&#39;b:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">F_cp_v_normData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="o">/</span><span class="n">max_amplitude</span><span class="p">,</span>
                                 <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span> <span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">max_amplitude</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]),</span><span class="mi">1</span><span class="p">))</span> <span class="p">])</span>
                                 <span class="p">])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">+</span> <span class="p">(</span><span class="n">line_F_cp_v</span><span class="p">,</span><span class="n">F_cp_v_normData</span><span class="p">)</span>
    
    <span class="c">#plot contact force horizontal dash line</span>
    <span class="n">line_F_cp_h</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39;b:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">F_cp_h_normData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span><span class="mi">3</span><span class="p">)),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span> <span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">max_amplitude</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]),</span><span class="mi">1</span><span class="p">))</span> <span class="p">])</span>
                                 <span class="p">])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">+</span> <span class="p">(</span><span class="n">line_F_cp_h</span><span class="p">,</span><span class="n">F_cp_h_normData</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    #plot contact force along radial direction        </span>
<span class="sd">    line_F_contact_radial=ax.plot([0,RBO.F_contact_radial[istep,0]],</span>
<span class="sd">                      [0,RBO.F_contact_radial[istep,1]],</span>
<span class="sd">                      [0,RBO.F_contact_radial[istep,2]],&#39;r-&#39;,marker=&#39;x&#39;)</span>
<span class="sd">    F_contact_radial_normData = np.hstack([np.zeros((len(RBO.F_contact_radial[:,0]),3)),RBO.F_contact_radial/max_amplitude])</span>
<span class="sd">    RBO.linesarg = RBO.linesarg + (line_F_contact_radial,F_contact_radial_normData)</span>
<span class="sd">            </span>
<span class="sd">    #plot contact force tangent to CM trajectory        </span>
<span class="sd">    line_F_contact_tan=ax.plot([0,RBO.F_contact_tan[istep,0]],</span>
<span class="sd">                      [0,RBO.F_contact_tan[istep,1]],</span>
<span class="sd">                      [0,RBO.F_contact_tan[istep,2]],&#39;r-&#39;,marker=&#39;d&#39;)</span>
<span class="sd">    F_contact_tan_normData = np.hstack([np.zeros((len(RBO.F_contact_tan[:,0]),3)),RBO.F_contact_tan/max_amplitude])</span>
<span class="sd">    RBO.linesarg = RBO.linesarg + (line_F_contact_tan,F_contact_tan_normData)</span>
<span class="sd">    &#39;&#39;&#39;</span>     
    <span class="c">#plot gravity force vector</span>
    <span class="n">line_F</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">0.09</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">0.09</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">RBO</span><span class="o">.</span><span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                   <span class="p">[</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">0.09</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">0.09</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">RBO</span><span class="o">.</span><span class="n">F</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                   <span class="p">[</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">0.09</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[</span><span class="n">istep</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">0.09</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">RBO</span><span class="o">.</span><span class="n">F</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="s">&#39;k-&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">F_normData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">0.09</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">RBO</span><span class="o">.</span><span class="n">F</span><span class="o">/</span><span class="n">max_amplitude</span><span class="o">+</span><span class="n">RBO</span><span class="o">.</span><span class="n">cordvec</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">0.09</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">=</span> <span class="n">RBO</span><span class="o">.</span><span class="n">linesarg</span> <span class="o">+</span> <span class="p">(</span><span class="n">line_F</span><span class="p">,</span><span class="n">F_normData</span><span class="p">)</span>
    
    <span class="c">#plot contact force trail&#39;s projection onto horizontal plane</span>
    <span class="k">if</span> <span class="n">RBO</span><span class="o">.</span><span class="n">DrawOption</span><span class="p">[</span><span class="s">&#39;CF_trail&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">line_F_cp_h_trail</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">max_amplitude</span><span class="p">,</span>
                                    <span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">max_amplitude</span><span class="p">,</span>
                                    <span class="n">RBO</span><span class="o">.</span><span class="n">F_cp</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">max_amplitude</span><span class="p">,</span><span class="s">&#39;r:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">)</span>

    <span class="c">#plot average force</span>
    <span class="c">#line_average_force = ax.plot()</span>

<span class="k">def</span> <span class="nf">rotmat_from_A_2_B</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return the active r.h. rotation matrix constructed from rotation vector :math:`C=A\\times B`. This matrix rotates any object in the world frame using rotation vector C.&#39;&#39;&#39;</span>
    <span class="n">rotunit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
    <span class="n">rotunit</span> <span class="o">=</span> <span class="n">rotunit</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rotunit</span><span class="p">)</span>
    <span class="n">thetarot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="n">B</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">B</span><span class="p">)))</span>
    <span class="n">rotmat</span> <span class="o">=</span> <span class="n">CK</span><span class="p">(</span><span class="n">thetarot</span><span class="o">*</span><span class="n">rotunit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rotmat</span>

<span class="k">def</span> <span class="nf">plot_body_space_cone</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">zn</span><span class="p">,</span><span class="n">omegavec</span><span class="p">,</span><span class="n">Lvec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Plot the body and space cone. A static one-time plot.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># Set up the grid in polar coordinate theta, radius</span>
    <span class="n">cone_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">bcone_radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">zn</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">zn</span><span class="p">,</span><span class="n">omegavec</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">omegavec</span><span class="p">)))</span>
    <span class="p">)</span>
    <span class="n">bcone_len</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">zn</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">zn</span><span class="p">,</span><span class="n">omegavec</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">omegavec</span><span class="p">))</span>
    
    <span class="n">cone_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">bcone_radius</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">c1T</span><span class="p">,</span> <span class="n">c1R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">cone_theta</span><span class="p">,</span> <span class="n">cone_r</span><span class="p">)</span>
    <span class="c"># Then calculate X, Y, and Z</span>
    <span class="n">c1X</span> <span class="o">=</span> <span class="n">c1R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">c1T</span><span class="p">)</span>
    <span class="n">c1Y</span> <span class="o">=</span> <span class="n">c1R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">c1T</span><span class="p">)</span>
    <span class="n">c1Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c1X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c1Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">bcone_radius</span><span class="o">*</span><span class="n">bcone_len</span>
    <span class="n">cmm</span><span class="p">,</span><span class="n">cnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">c1Z</span><span class="p">)</span>
    <span class="n">mat_zn2omega</span> <span class="o">=</span> <span class="n">rotmat_from_A_2_B</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">zn</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cmm</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cnn</span><span class="p">):</span>
            <span class="n">c1X</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">c1Y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">c1Z</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mat_zn2omega</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c1X</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">c1Y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">c1Z</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]]))</span>
    <span class="c"># space cone</span>
    <span class="n">scone_radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">omegavec</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Lvec</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">Lvec</span><span class="p">),</span><span class="n">omegavec</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">omegavec</span><span class="p">)))</span>
    <span class="p">)</span>
    <span class="n">scone_len</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">omegavec</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Lvec</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">Lvec</span><span class="p">),</span><span class="n">omegavec</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">omegavec</span><span class="p">))</span>
    
    <span class="n">cone_r_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">scone_radius</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">c2T</span><span class="p">,</span> <span class="n">c2R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">cone_theta</span><span class="p">,</span> <span class="n">cone_r_s</span><span class="p">)</span>
    <span class="c"># Then calculate X, Y, and Z</span>
    <span class="n">c2X</span> <span class="o">=</span> <span class="n">c2R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">c2T</span><span class="p">)</span>
    <span class="n">c2Y</span> <span class="o">=</span> <span class="n">c2R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">c2T</span><span class="p">)</span>
    <span class="n">c2Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c2X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c2Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">scone_radius</span><span class="o">*</span><span class="n">scone_len</span>
    <span class="n">cmm2</span><span class="p">,</span><span class="n">cnn2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">c2Z</span><span class="p">)</span>
    <span class="n">mat_omega2L</span> <span class="o">=</span> <span class="n">rotmat_from_A_2_B</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">Lvec</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cmm2</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cnn2</span><span class="p">):</span>
            <span class="n">c2X</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">c2Y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">c2Z</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mat_omega2L</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c2X</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">c2Y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">c2Z</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]]))</span>
            
    
    <span class="c"># Set the Z values outside your range to NaNs so they aren&#39;t plotted</span>
<span class="c">#    c1Z[c1Z &lt; 0] = np.nan</span>
<span class="c">#    c1Z[c1Z &gt; 2.1] = np.nan</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">c1X</span><span class="p">,</span> <span class="n">c1Y</span><span class="p">,</span> <span class="n">c1Z</span><span class="p">,</span><span class="n">rstride</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.16</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span><span class="p">)</span>    
    <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">c2X</span><span class="p">,</span> <span class="n">c2Y</span><span class="p">,</span> <span class="n">c2Z</span><span class="p">,</span><span class="n">rstride</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.16</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span><span class="p">)</span>    
<span class="c">#    ax.set_zlim(0,1)</span>
    
<span class="k">def</span> <span class="nf">plot_cube_4wires</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">cube4wires</span><span class="p">,</span><span class="n">xframe</span><span class="p">,</span><span class="n">zn</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    No use. Plot the cube from cube vertex data using 4 separate lines each with equal number of segments.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">cube_111node_aligning_to_z</span> <span class="o">=</span> <span class="mf">0.18</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmat_from_A_2_B</span><span class="p">(</span><span class="n">cube4wires</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">zn</span><span class="p">),</span>
                                         <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">cube4wires</span><span class="p">))</span><span class="c">#np.transpose(cube4wires)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
            <span class="n">cube_111node_aligning_to_z</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cube_111node_aligning_to_z</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">zn</span><span class="o">*</span><span class="mf">0.18</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    
 <span class="c">#   cubeinst1 = ax.plot(*cube_111node_aligning_to_z[:,0:4],c=&#39;b&#39;,linewidth=.5)</span>
 <span class="c">#   cubeinst2 = ax.plot(*cube_111node_aligning_to_z[:,4:8],c=&#39;b&#39;,linewidth=.5)</span>
  <span class="c">#  cubeinst3 = ax.plot(*cube_111node_aligning_to_z[:,8:12],c=&#39;b&#39;,linewidth=.5)</span>
   <span class="c"># cubeinst4 = ax.plot(*cube_111node_aligning_to_z[:,12:16],c=&#39;b&#39;,linewidth=.5)</span>
    <span class="k">return</span> <span class="n">cube_111node_aligning_to_z</span>
</pre></div>
