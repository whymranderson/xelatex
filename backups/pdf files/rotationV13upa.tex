\documentclass[12pt,twoside]{article}
%\documentclass[12pt,a4paper]{article}
\usepackage{amsmath}
\usepackage{fontspec}
\usepackage{xeCJK}
\setmainfont{Times New Roman}
\setsansfont{Verdana}
\setmonofont{Courier New}
\setCJKmainfont[AutoFakeBold=1.5]{微軟正黑體}
\setCJKfamilyfont{kai}{標楷體}
\newcommand*{\kai}{\CJKfamily{kai}}
\usepackage[inner=1in,outer=0.6in,top=0.7in,bottom=1in]{geometry}
\usepackage{unicode-math}
\usepackage{graphicx}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage[hidelinks]{hyperref}
\usepackage{pgf}
\usepackage{pstricks,pst-node,pst-3dplot}
\usepackage{minted}
\usepackage{pdfpages}
\usepackage{mdframed}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyfoot[LE,RO]{\thepart-\thepage}
\renewcommand{\headrulewidth}{0pt}

\setcounter{MaxMatrixCols}{10}
%TCIDATA{OutputFilter=LATEX.DLL}
%TCIDATA{Version=5.00.0.2606}
%TCIDATA{<META NAME="SaveForMode" CONTENT="1">}
%TCIDATA{BibliographyScheme=Manual}
%TCIDATA{Created=Monday, January 13, 2014 11:43:31}
%TCIDATA{LastRevised=Sunday, March 22, 2015 12:09:34}
%TCIDATA{<META NAME="GraphicsSave" CONTENT="32">}
%TCIDATA{<META NAME="DocumentShell" CONTENT="International\Traditional Chinese Article">}
%TCIDATA{CSTFile=Traditional Chinese.cst}

\newtheorem{theorem}{Theorem}
\newtheorem{acknowledgement}[theorem]{Acknowledgement}
\newtheorem{algorithm}[theorem]{Algorithm}
\newtheorem{axiom}[theorem]{Axiom}
\newtheorem{case}[theorem]{Case}
\newtheorem{claim}[theorem]{Claim}
\newtheorem{conclusion}[theorem]{Conclusion}
\newtheorem{condition}[theorem]{Condition}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{criterion}[theorem]{Criterion}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}
\newtheorem{exercise}[theorem]{Exercise}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{notation}[theorem]{Notation}
\newtheorem{problem}[theorem]{Problem}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{solution}[theorem]{Solution}
\newtheorem{summary}[theorem]{Summary}
\newenvironment{proof}[1][Proof]{\noindent\textbf{#1.} }{\ \rule{0.5em}{0.5em}}
\input{tcilatex}
\renewcommand{\today}{西元\number \year 年\ifcase \month \or 1月\or 2月\or 3月\or 4月\or 5月\or 6月\or 7月\or 8月\or 9月\or 10月\or 11月\or 12月\fi
} 

\begin{document}


%TCIMACRO{\TeXButton{gyrologo5 pgf image}{\input{gyrologo5.pgf}} }%
%BeginExpansion
\input{gyrologo5.pgf}
%EndExpansion
%TCIMACRO{\TeXButton{title pgf3 image}{\input{title3.pgf}}}%
%BeginExpansion
\input{title3.pgf}%
%EndExpansion

\part{導言\protect\bigskip}

當我們談到陀螺的三%
維運動，多數動力學%
的書上推導出貼體角%
速度的尤拉方程之後%
，就會求諸Euler angles來得到%
Lagrangian，接著用elliptical integral解出%
解析解。或者，以數%
值方法解其尤拉角的%
尤拉方程ODE，然後再以%
尤拉角模擬其運動。%
不過，若對尤拉方程%
透徹理解，只要有貼%
體角速度，也可以利%
用轉動向量﹝rotation vector﹞%
，用姿態估測的方法%
直接簡單地數值模擬%
剛體轉動，這樣就不%
需要用到Lagrangian或Euler angles。%
這個方法屬於姿態估%
測學中的方向餘弦遞%
推法﹝iteration of direction cosine matrix, DCM﹞%
。這裡將姿態﹝orientation 姿%
態 or attitude 航向，這裡統稱%
姿態。﹞動力學與姿%
態估測應用在剛體轉%
動的尤拉運動方程上%
，以姿態估測中的方%
向餘弦法來積分尤拉%
方程的貼體角速度轉%
動向量，以此達到模%
擬剛體的轉動，並且%
應用在陀螺的三維運%
動上。一般會覺得貼%
體角速度並沒有多大%
的用處，不過事實上%
在姿態動力學中，正%
是以正確地積分貼體%
角速度來得到姿態的%
運動。這邊不只介紹%
公式，還以淺顯易懂%
的方式給出姿態的運%
動方程，所以只要有%
基礎的線性代數矩陣%
知識，就可以掌握此%
方法。這裡詳述的這%
些理論在書籍上比較%
少見，在航太領域或%
電機的姿態控制領域%
有些講解，但也缺乏%
清楚的解釋，只給出%
複雜的公式，這樣在%
應用層面的時候會發%
生比較多不必要的試%
誤與嘗試。這裡我將%
這觀念連結錯綜複雜%
的東西清楚地寫下來%
，並且提供一個實作%
的例子，以供自己以%
及別人參考。

\bigskip

這裡詳述的方法可以%
廣泛的運用於任何剛%
體轉動或其尤拉方程%
。因此，此處所涉及%
的方向餘弦遞推的完%
整理解還可應用上其%
他相關領域。舉例來%
說，這裡在作陀螺模%
擬的姿態演算程式可%
以用在陀螺儀這類型%
的綁附式慣性感測器\cite%
[Ch 3.6.4]{titterton}上，積分測得的%
貼體角速度來作姿態%
估測，這將在第四章%
作介紹。仿間姿態演%
算法林立，但多數是%
沒有經過驗證的。這%
邊從根本的推導開始%
，一步步進階到實用%
的程式碼，每一步推%
導都有合理的邏輯，%
並且轉動矩陣都有標%
明轉動方向是遵守左%
手還是右手定則，以%
及標明轉動矩陣是取%
其主動性轉向量或是%
被動性轉坐標軸，這%
一點是所有書上或網%
路上的程式所共同缺%
乏的，而這在實際應%
用的時候尤其重要，%
這樣子推導出來的公%
式我們可以很方便的%
檢查其正確性，也可%
以很放心地應用在其%
他地方。另外，這邊%
提供與第三方理論及%
程式碼的驗證，證實%
我們公式及程式的正%
確性。這裡介紹的尤%
拉方程的數值化也可%
以應用上剛體物理模%
擬﹝simulation of rigid body﹞，這在%
電腦遊戲的物理引擎\cite%
[Ch 2.3]{pixarnote}中也有其廣泛的%
應用性。這邊我們呈%
現以這些方法數值模%
擬三維陀螺運動。這%
邊提供的詳細解說也%
適合當作大學物理，%
電機，機械或航太系%
在剛體運動的衍伸教%
材。

\bigskip

也有其他人做過類似%
的陀螺模擬，舉例如%
Wolfgang Christian教授\cite{wolfgangSimMeth}，以%
及Eugene Bukitov教授\cite{eugene}，不過%
都沒有我們這邊完整%
。比如說，Christian教授的%
程式無法改變$\omega _{2}$的參%
數，因此無法觀察到%
波紋及正圓兩種章動%
進動運動。Bukitov教授的%
參數只能在某區間裡%
以拉桿調整，而我們%
的程式沒有參數的限%
制，可以做任意運動%
狀態的模擬。Christian教授%
使用的是四元數遞推%
法。四元數法與我這%
裡的方向餘弦法在數%
學上是同義的。兩位%
教授都沒有提供跟其%
他方法做比較驗證的%
選項，我這裡是有跟%
Lagrange法的數值解做驗證%
比較。我下一步也希%
望能跟四元數法這類%
的數值解能做比較。%
Bukitov教授沒有公開他的%
演算法，因此不曉得%
他是用哪種方法模擬%
。很感謝Christian教授有提%
供java的source code，不過我還%
在思考怎麼將我的Python%
結果跟他的Java結果比較%
。值得一提的是，他%
有把他的Java程式寫成一%
個獨立的pc端執行檔，%
公開在comPADRE網路上，此%
程式是互動性的，使%
用起來非常的方便，%
這也是我的目標之一%
。四元數及方向餘弦%
法的理論可以在\cite{rapaport}%
文獻書中找到，姿態%
估測演算法的深度理%
論可參考文章\cite{savage}，不%
過裡面並沒有提供實%
際的模擬。

這裡的實際應用例子%
也提供了一個，以尤%
拉方程來驗證姿態估%
測演算法的正確性的%
一個實例。即以尤拉%
方程解析解或數值解%
給出的貼體角速度來%
做姿態估測，結果再%
與原本的尤拉角解析%
結果直接比較，這樣%
比較的即是姿態估測%
演算法的估測能力，%
這會在文中詳述。這%
邊似乎是第一個完整%
結合尤拉方程與姿態%
估測並實際應用的例%
子。

這篇文章的架構是：

\begin{enumerate}
\item 第一部分為最完整%
的剛體轉動運動方程-%
牛頓尤拉﹝Newton-Euler or Euler﹞方%
程的推導證明。因為%
要做轉動軸的轉動向%
量數值積分必須要對%
尤拉方程有最正確的%
理解。這邊補充了Goldstein
Classical Mechanics\cite{goldstein}中的證明觀%
念跳來跳去的缺失，%
以及大多數的書上推%
導尤拉方程解釋模糊%
的地方。轉動理論多%
數的講述通常過於複%
雜，要不就是過於簡%
化，缺乏與基本原理%
的結合，並且大部分%
也無提供實際實例操%
作這非常重要的一環%
，這裡則提供完整的%
陀螺模擬實例與完整%
公開的code供練習。

\item 接著藉由第一段尤%
拉方程的推導來嚴謹%
的證明Euler equation中的貼體%
角速度﹝angular velocity along body frame﹞%
可直接用於建立剛體%
特徵軸與lab frame間的主動%
與被動轉動矩陣\thinspace ，%
並以此推導出方向餘%
弦法的主要遞推原理%
來積分剛體轉動，追%
蹤每一時刻的剛體特%
徵軸在lab frame的位置。並%
以python程式編寫演算法%
，並以python繪圖庫matplotlib來%
作3D動畫。

\item 接著說明了以貼體%
轉動向量來近似t到t+dt時%
間的微小轉動時我們%
將以在t+dt時間的貼體角%
速度來近似，即以$\vec{\omega}%
_{b}\left( t+dt\right) $來建立dt時間內%
的轉動矩陣$\footnote{%
The path order exponential of $\vec{\omega}_{b}$ from time t to t+dt. This
will be discussed more in the text.}$。這裡也比%
較一般常見的$\vec{\omega}_{b}\left(
t\right) $方法的結果來證明%
此優化所帶來精度上%
的提升。最後將以上%
方法應用上陀螺的三%
維運動，模擬結果將%
與文獻\cite{hasbun}的尤拉角法%
做比較。

\item 最後說明如何以以%
上的基礎來建立三種%
姿態估測演算法。其%
中一種即為慣性角速%
度感測器﹝IMU﹞的姿態%
解算基礎。另一種為%
利用力矩項的姿態估%
測演算法，適合用於%
電腦姿態模擬。最後%
一種為傳統的尤拉角%
加Lagrangian法。我們的程式%
可以在同一個動畫平%
台上同時比較這三種%
方法的正確性，因此%
相當於是一個姿態估%
測能力的比較平台。
\end{enumerate}

%TCIMACRO{\TeXButton{clearpage}{\clearpage}}%
%BeginExpansion
\clearpage%
%EndExpansion

\part{尤拉方程與姿態動%
力方程的推導}

\setcounter{page}{1}\bigskip

若你有認真思考過轉%
動的問題，你應該會%
曾經有過下面的疑問%
。

\begin{enumerate}
\item 牛頓尤拉方程\ref{liw}中%
的力矩項，明明在推%
導的時候是沿著固定%
的space座標取分量，為什%
麼在計算在應用的時%
候反而要沿著貼體的body%
座標取分量？﹝如Goldstein
classical mechanics第二版書中4-124公%
式﹞

\item 若我隨著轉動座標%
系運動，那麼我觀察%
到此座標系的轉動角%
速度應該是零，因為%
我隨著此座標系運動%
，但是body angular velocity偏偏又不%
是零？到底怎麼回事%
？那角度感測器angular rate sensor%
量到的也不是零，那%
它量到的到底又是甚%
麼東西，我們怎麼用%
它？

\item 貼體角速度﹝body angular velocity%
﹞明明是angular velocity沿著body投%
影的分量，為什麼在%
帶入公式的時候它會%
等於剛體特徵軸的軸%
轉動角速度？body angular velocity是%
不是等於轉動座標軸%
中\emph{觀測}到的angular velocity？

\item 與上一點非常相關%
，一般認為貼體角速%
度無太大用處，事實%
上在剛體運動中，貼%
體角速度因姿態動力%
學而有許多廣泛的應%
用性。
\end{enumerate}

這邊很少有書上會去%
詳細解釋清楚，這裡%
從最根本出發一次解%
決你的疑惑。

\bigskip

首先我們必須再次證%
明向量變化量在不同%
觀測座標中的關係，%
即公式\ref{eq1}，這次你會%
發現在應用此公式的%
時候有不少地方是要%
注意的。由於當我實%
際在解這問題時我發%
現Goldstein classical mechanics書中還有幾%
點證明在應用層面還%
不夠清楚，讓我在應%
用的時候花了好多時%
間去釐清，因此這邊%
寫上我認為可以補充%
書上的推導證明。首%
先我們從以下公式開%
始

\begin{equation}
\left( \frac{d\vec{L}}{dt}\right) _{s}=\left( \frac{d\vec{L}}{dt}\right)
_{b}+\vec{\omega}\times \vec{L}  \label{eq1}
\end{equation}%
對此公式的理解將是%
整篇文章最重要的基%
礎。此公式如何而來%
？此公式為一隨時間%
變動的向量在恆定座%
標與非恆定座標(此例%
為轉動中座標)之間線%
性變換的結果。以下%
是此公式的推導。

\begin{figure}[th]
\caption{{}}
\label{firstfig}
\begin{center}
\fbox{\input{rateofchange.pgf}}
\end{center}
\end{figure}
\bigskip

首先考慮一恆定座標%
S(space)，一轉動座標b(body)，%
為了方便討論矩陣轉%
換的主被動性與座標%
轉換的左右手法則，%
我們這邊方便的先假%
設$\hat{S}_{x}， \hat{b}_{x}$兩軸重合%
，因此圖中顯示了body frame%
沿著$+\hat{S}_{x}$遵守右手定%
則逆時針轉了$\Omega $角度%
，依右手定則此角位%
移向量$\hat{\Omega}$會在$+\hat{S}_{x}$方%
向。但是接下來的推%
導以及所有公式都適%
用任意的座標旋轉，%
這邊是為了方便討論%
矩陣的主動被動的方%
向性，以及在之後的%
推導方便我們追蹤正%
負號以及矩陣主動被%
動意義的改變，因此%
在圖中做了一個方便%
我們思考的情形。另%
外，大部分書上在討%
論座標轉換時有時候%
給的公式是遵守左手%
定則，但這與物理定%
律所採納的右手定則%
相反，因此這邊我寫%
下完整的右手定則的%
推導，希望之後的人%
不需要像我一樣花了%
大半時間在轉換不同%
公式間左手右手定則%
帶來的正負號的改變%
。

依照圖\ref{firstfig}所示，我%
們可以寫下$\vec{A}$向量在S,b%
座標間的關係%
\begin{equation*}
\left( \vec{A}\right) _{b}=\underset{\text{passive, r.h.}}{\Omega }\left( 
\vec{A}\right) _{s}
\end{equation*}%
其中$\Omega $是s frame到b frame的座%
標轉換矩陣，因為是%
轉換座標軸，因此矩%
陣取被動含意，並且%
我們採用右手定則，%
因此逆時針方向為正%
方向。接下來只要有%
用到矩陣的運算我都%
會標明主被動及左右%
手(r.h. right-hand or l.h. left-hand)，這樣我%
們可以很快速對照圖%
表來理解轉動方向，%
這很重要。

若我們考慮$\Omega $的角度%
很小$\Omega \rightarrow d\Omega $(infinitesimal rotation)，%
則$d\Omega $矩陣與unity matrix相去%
不遠，可以寫成$1$(unity matrix) +$%
\epsilon $(infinitesimal matrix)，$\epsilon $具有%
antisymmetric matrix的特性\cite[p. 169]{goldstein}，%
帶入上式%
\begin{equation*}
\left( \vec{A}\right) _{b}=\underset{\text{passive, r.h.}}{\left( 1+\epsilon
\right) }\left( \vec{A}\right) _{s}
\end{equation*}%
infinitesimal matrix有個特性，很容%
易自行驗證，%
\begin{equation*}
\underset{\text{r.h., passive or active}}{\epsilon }=\left[ 
\begin{array}{ccc}
0 & \epsilon _{3}\geq 0 & -\epsilon _{2}\leq 0 \\ 
-\epsilon _{3} & 0 & \epsilon _{1}\geq 0 \\ 
\epsilon _{2} & -\epsilon _{1} & 0%
\end{array}%
\right] \text{, }\underset{\text{l.h., passive or active}}{\epsilon }=\left[ 
\begin{array}{ccc}
0 & -\epsilon _{3}\leq 0 & \epsilon _{2}\geq 0 \\ 
+\epsilon _{3} & 0 & -\epsilon _{1}\leq 0 \\ 
-\epsilon _{2} & \epsilon _{1} & 0%
\end{array}%
\right]
\end{equation*}

現在我們考慮$\vec{A}$是$+\hat{b}%
_{y}$軸的狀況，不過考慮%
相同矩陣$\left( 1+\epsilon \right) $的主%
動特性，也就是主動%
轉向量，這樣的話轉%
動方向會與原本的方%
向相反，變左手定則%
，我們會得到%
\begin{equation*}
\left( \hat{S}_{y}\right) _{s}=\underset{\text{active, l.h.}}{\left(
1+\epsilon \right) }\times \left( \hat{b}_{y}\right) _{s}
\end{equation*}%
整理一下%
\begin{equation*}
\left( \hat{b}_{y}\right) _{s}=\underset{\text{active, r.h.}}{\underbrace{%
\left[ \left( 1+\epsilon \right) \right] ^{T}}}\times \left( \hat{S}%
_{y}\right) _{s}=\underset{\text{active, r.h.}}{\left( 1-\epsilon \right) }%
\times \left( \hat{S}_{y}\right) _{s}
\end{equation*}%
代入上面r.h. $\epsilon $的公式(%
因$\epsilon $還是原本的矩陣)%
，整理一下%
\begin{equation*}
\left( \hat{b}_{y}\right) _{s}-\left( \hat{S}_{y}\right) _{s}=-\left[ 
\begin{array}{ccc}
0 & \epsilon _{3}\geq 0 & -\epsilon _{2}\leq 0 \\ 
-\epsilon _{3} & 0 & \epsilon _{1}\geq 0 \\ 
\epsilon _{2} & -\epsilon _{1} & 0%
\end{array}%
\right] \times \left( \hat{S}_{y}\right) _{s}
\end{equation*}%
利用向量外積，上式%
也可寫成%
\begin{equation*}
\left( \hat{b}_{y}\right) _{s}-\left( \hat{S}_{y}\right) _{s}=\left( \vec{%
\epsilon}\right) _{s}\times \left( \hat{S}_{y}\right) _{s}
\end{equation*}%
其中$\vec{\epsilon}=\left[ 
\begin{array}{c}
\epsilon _{1} \\ 
\epsilon _{2} \\ 
\epsilon _{3}%
\end{array}%
\right] _{s}$為一向量，在S frame中%
的分量為$\epsilon _{1}$，$\epsilon _{2}$%
，$\epsilon _{3}$。

現在我們將上式跟微%
小轉動公式Rodrigues rotation formula比%
較%
\begin{equation*}
\vec{r}^{\prime }-\vec{r}=d\vec{\Omega}\times \vec{r}
\end{equation*}%
$d\vec{\Omega}$是r到r'的r.h.角位移%
向量\thinspace ，因此我們得%
到$\vec{\epsilon}=d\vec{\Omega}$，$d\vec{\Omega}$就是%
s frame到b frame的角位移向量%
(follow r.h. rule)%
\begin{equation*}
\left( \hat{b}_{y}\right) _{s}-\left( \hat{S}_{y}\right) _{s}=\left( d\vec{%
\Omega}\right) _{s}\times \left( \hat{S}_{y}\right) _{s}
\end{equation*}%
這一點很重要，因為%
我們將證明此$\left( d\vec{\Omega}\right)
_{s}$跟接下來我們要推導%
的尤拉公式中的貼體%
角速度$\vec{\omega}$有直接相%
關性，並且以此來做%
我們模擬剛體轉動的%
基礎。

以上的討論是考慮$\vec{A}$%
向量不隨時間變動的%
情況，接下來我們必%
須討論$\vec{A}$以及b frame皆隨%
時間變動的狀況。

\begin{figure}[th]
\caption{Rate change of a vector observed in a inertial and non-inertial
frame.}
\label{ratevecfig}
\begin{center}
\fbox{\input{rateofchanget2tdt.pgf}}
\end{center}
\end{figure}

在時間t時我們令S與b frame%
重合，過了dt時間原本%
的$\vec{A}$向量加了一改變%
量$d\vec{A}$變成$\vec{A}^{\prime }$，並且%
b frame依右手定則轉動了%
一微小角度(infinitisemal rotation)，%
在此前提下，向量$\vec{A}$%
在t時間符合%
\begin{equation}
\left( \vec{A}\right) _{s(t)}=\left( \vec{A}\right) _{b(t)}  \label{roc1}
\end{equation}%
接著，在t+dt時間$\vec{A}+d\vec{A}$%
向量在s與b frame間的關係%
為%
\begin{equation}
\left( \vec{A}^{\prime }\right) _{b(t+dt)}=\underset{\text{passive, r.h.}}{%
\Omega }\left( \vec{A}^{\prime }\right) _{s(t+dt)}  \label{roc1dt}
\end{equation}%
$\Omega $為s, b frame轉動矩陣(passive r.h.)%
，此$\Omega $矩陣與上一段$%
\vec{A}$不變動的情況的$\Omega $%
矩陣完全相同，我們%
取s到b frame的轉動為微小%
量，$\Omega \rightarrow d\Omega $，上式依%
之前所述的原理可寫%
成%
\begin{equation*}
\left( \vec{A}^{\prime }\right) _{b(t+dt)}=\underset{\text{passive, r.h.}}{%
\left( 1+\epsilon \right) }\left( \vec{A}^{\prime }\right) _{s(t+dt)}
\end{equation*}%
要強調這邊的$\epsilon $矩陣%
跟之前上一段的$\epsilon $矩%
陣是完全相同的，代%
入\ref{roc1dt}式重新整理上式%
\begin{equation}
\left( \vec{A}^{\prime }\right) _{s(t+dt)}=\left( \vec{A}^{\prime }\right)
_{b(t+dt)}-\epsilon \left( \vec{A}^{\prime }\right) _{s(t+dt)}  \label{roc2}
\end{equation}%
接著我們用\ref{roc2}式減去%
\ref{roc1}式，%
\begin{eqnarray}
\left( \vec{A}^{\prime }\right) _{s(t+dt)}-\left( \vec{A}\right) _{s(t)}
&=&\left( d\vec{A}\right) _{s}\text{ , (the change in observable A in space
frame)}  \notag \\
&=&\left( \left( \vec{A}^{\prime }\right) _{b(t+dt)}-\left( \vec{A}\right)
_{b(t)}\right) -\epsilon \left( \vec{A}^{\prime }\right) _{s(t+dt)}  \notag
\\
&=&\left( d\vec{A}\right) _{body}-\epsilon \left( \vec{A}^{\prime }\right)
_{s(t+dt)}  \notag \\
&=&\left( d\vec{A}\right) _{body}-\epsilon \left( \vec{A}+d\vec{A}\right)
_{s(t+dt)}  \label{roc4}
\end{eqnarray}%
注意，由於s frame式恆定%
座標因此s frame不變動，$%
s(t+dt)=s(t)$。忽略高階項$\epsilon
\left( d\vec{A}\right) _{s(t+dt)}$，重新整理%
成%
\begin{equation*}
\left( d\vec{A}\right) _{s}=\left( d\vec{A}\right) _{b}-\underset{\text{r.h.}%
}{\epsilon }\left( \vec{A}\right) _{s(t)}
\end{equation*}%
接下來我們只要記得%
我們的下標b frame總是在t+dt%
時的frame，s frame總是指在t時%
間的frame，我們將不再寫%
出frame所對應的時間。依%
之前所述原理代入r.h. $%
\epsilon $的公式，並且利用%
向量外積%
\begin{eqnarray}
\left( d\vec{A}\right) _{s} &=&\left( d\vec{A}\right) _{b}-\left[ 
\begin{array}{ccc}
0 & \epsilon _{3}\geq 0 & -\epsilon _{2}\leq 0 \\ 
-\epsilon _{3} & 0 & \epsilon _{1}\geq 0 \\ 
\epsilon _{2} & -\epsilon _{1} & 0%
\end{array}%
\right] \left( \vec{A}\right) _{s}  \notag \\
&=&\left( d\vec{A}\right) _{b}-\left( \vec{A}\right) _{s}\times \left( d\vec{%
\Omega}\right) _{s}  \label{roc3} \\
&=&\left( d\vec{A}\right) _{b}+\left( d\vec{\Omega}\right) _{s}\times \left( 
\vec{A}\right) _{s}  \notag
\end{eqnarray}%
因為這裡的$\epsilon $矩陣與%
上一段的$\epsilon $矩陣是一%
樣的，因此我們也可%
以用上之前轉動公式%
所推導的微小轉動矩%
陣$\epsilon $所對應的轉動向%
量$\left( d\vec{\Omega}\right) $，這樣我%
們就得到了rate of change of a
vector/observable in a rotating frame公式%
\begin{equation}
\left( d\vec{A}\right) _{s}=\left( d\vec{A}\right) _{b}+\left( d\vec{\Omega}%
\right) _{s}\times \left( \vec{A}\right) _{s}  \label{rateofdomega}
\end{equation}%
我們連結了不同觀測%
座標觀測到的物理變%
化量，並且所用到都%
是已知的物理量$\left( d\vec{\Omega}%
\right) _{s}$與$\left( \vec{A}\right) _{s}$。這邊%
要強調，因為這裡的$%
\epsilon $矩陣與上一段的$\epsilon $%
矩陣是一樣的，所以%
證明了$d\vec{\Omega}$所對應的%
向量就是s frame轉到b frame的%
角位移向量(r.h.)，這樣%
強調的目的是，接下%
來$d\vec{\Omega}$所導出的貼體%
角速度，就是s frame轉到b
frame的角速度，因為這跟%
一般我們對貼體角速%
度的定義與認知並不%
一樣，這裡再次強調%
，我們必須考慮了t時%
間s與b frame重合，才能得%
到這結果。接下來會%
說明，也是因為如此%
，我們才能利用貼體%
角速度來作座標軸的%
轉動追蹤，因此此觀%
念至關重要。另外要%
注意的是$\vec{A}$與$d\vec{\Omega}$是%
沿著t時間的s frame取的投%
影量。這邊值得一提%
的是，傳統公式大多%
寫成%
\begin{equation*}
\left( d\vec{A}\right) _{s}=\left( d\vec{A}\right) _{b}+\left( d\vec{\Omega}%
\right) _{b}\times \left( \vec{A}\right) _{b}
\end{equation*}%
為什麼這邊的$d\vec{\Omega}$是%
沿著body取分量呢？注意%
\ref{roc3}式中當我們將微小%
轉動矩陣$\epsilon $寫成向量$d%
\vec{\Omega}$時，我們並沒有侷%
限此向量是定義在哪%
一個觀測座標，因此%
沿著s或b frame取都是可以%
的。另外\ref{roc4}式中我們%
忽略了高階項$\epsilon \left( d\vec{A}%
\right) _{s(t+dt)}$，因此留下了$\epsilon
\left( \vec{A}\right) _{s(t+dt)}=\epsilon \left( \vec{A}\right) _{s(t)}$%
，但其實我們也可以%
取另一個近似%
\begin{equation*}
-\epsilon \left( \vec{A}+d\vec{A}\right) _{s(t+dt)}=-\epsilon \left( \vec{A}%
\right) _{b(t+dt)}
\end{equation*}%
若我們考慮s到b frame的轉%
動非常的微小，我們%
只是做了一個不一樣%
的忽略方法。這樣的%
話，我們就得到傳統%
公式。這裡也是Goldstein\cite%
{goldstein}裡面的附註說明$\left( d%
\vec{\Omega}\right) \times \left( \vec{A}\right) $沿著s或b
frame取分量都是可以的，%
只要外積矩陣運算後%
出來的結果是一樣的%
就可以，不過他並沒%
有給出背後的原因。

\ref{rateofdomega}式取微分即得到%
一般常見的形式，這%
邊我們取沿s frame給出的%
公式，方便我們之後%
作數值模擬%
\begin{equation}
\left( \frac{d\vec{A}}{dt}\right) _{s}=\left( \frac{d\vec{A}}{dt}\right)
_{b}+\left( \vec{\omega}\right) _{s}\times \left( \vec{A}\right) _{s}
\label{rateofchange}
\end{equation}%
其中$\left( \vec{\omega}\right) _{s}$為$\left( \frac{d\vec{%
\Omega}}{dt}\right) _{s}$，根據我們之%
前對$d\vec{\Omega}$的定義與強%
調，我們知道$\left( \vec{\omega}\right)
_{s}$即為s frame到b frame的瞬時角%
速度。

嚴謹的定義了$d\vec{\Omega}$與$%
\left( \vec{\omega}\right) _{s}$後，我們接%
著需要討論如何從$\left( \vec{%
\omega}\right) _{s}$求回相對應的轉%
動矩陣，這邊你會認%
為，不是將$\left( \vec{\omega}\right) _{s}$%
的xyz分量帶入之前$1+\epsilon $%
矩陣中的$\epsilon _{1}\epsilon _{2}\epsilon _{3}$%
就可以了嗎，這樣是%
不行的，因為從之前%
微小轉動的推導可以%
看出，$\epsilon _{1}\epsilon _{2}\epsilon _{3}$是%
符合特定的antisymmetric matrix properties%
的，但任意的角速度%
向量$\left( \vec{\omega}\right) _{s}$可不然%
。這邊我們利用Calvin Klein
parameter來近似原本的轉動%
矩陣﹝CK parameters矩陣可從轉%
動公式Rodrigues rotation formula推導，%
它們數學上是同源的%
，參考\cite{goldstein}﹞，這邊%
我們給他一個代號$CK(d\vec{%
\Omega})$，當然，接下來只%
要是矩陣運算我們都%
會寫上$CK$的主被動及左%
右手性質，方便我們%
與圖對照與思考\footnote{物%
理上力矩給出的角速%
度是遵守右手定則%
(counterclockwise，不過說順或逆%
時針常常會造成困擾%
，因順逆時針方向是%
軸方向正對著我們自%
己的時候給出的方向%
。)，所以CK矩陣必須使%
用其active r.h. sense才能描述正%
確向量轉動，要小心%
，因大部分書上(如Goldstein)%
給的公式都是active l.h. (舉例%
如書上的Caley Klein parameter rotation matrix)%
，因此差一個負號，%
這裡我也花了許多時%
間把文獻上所有公式%
轉成了正確的右手定%
則。}。%
\begin{eqnarray*}
\underset{\text{active, r.h.}}{CK(d\vec{\Omega})} &=&\left[ 
\begin{array}{ccc}
a^{2}+b^{2}-c^{2}-d^{2} & 2(bc-ad) & 2(bd+ac) \\ 
2(bc+ad) & a^{2}+c^{2}-b^{2}-d^{2} & 2(cd-ab) \\ 
2(bd-ac) & 2(cd+ab) & a^{2}+d^{2}-b^{2}-c^{2}%
\end{array}%
\right] \text{,} \\
\text{with }a &=&\cos \left( \frac{\left\vert d\vec{\Omega}\right\vert }{2}%
\right) \text{, b, c, d = component of }d\hat{\Omega}\cdot \sin \left( \frac{%
\left\vert d\vec{\Omega}\right\vert }{2}\right)
\end{eqnarray*}%
現在，我們一再強調$d%
\vec{\Omega}$所對應的是s frame轉動%
到b frame，因此我們建立%
的$CK(d\vec{\Omega})$矩陣具有以下%
的特性，根據圖\ref{ratevecfig}%
我們可以寫下，%
\begin{eqnarray}
\left( \vec{A}\right) _{s} &=&\underset{\text{passive, l.h.}}{CK(d\vec{\Omega%
})}\times \left( \vec{A}\right) _{b}  \label{frametrans} \\
\left( \hat{b}_{y}\right) _{s} &=&\underset{\text{active, r.h.}}{CK(d\vec{%
\Omega})}\times \left( \hat{S}_{y}\right) _{s}  \label{vecrot}
\end{eqnarray}%
這代表了，若我們知%
道s frame到b frame的轉動角度%
，我們就可以求出t+dt時%
間的xyz軸在t時間xyz軸的%
投影量。若我們知道%
的是s到b frame的瞬時角速%
度$\left( \vec{\omega}\right) _{s}$則可帶入$%
CK(\left( \vec{\omega}\right) _{s}\cdot dt)^{T}$來得到%
轉矩矩陣。以上兩式%
就是模擬或追蹤剛體%
的body frame的x,y,z軸轉動的基%
礎。

\begin{figure}[th]
\caption{How to apply rate-of-change-of-a-vector equation to numerically
simulate a true rotation. Here $S_{x}S_{y}b_{x}b_{y}$ are not shown.}
\label{szsbtdtfig}
\begin{center}
\fbox{\input{SzBz.pgf}}
\end{center}
\end{figure}

\bigskip

上述的微小轉動是只%
考慮t到t+dt時間內的變化%
，現在我們將用遞推%
並且discrete的方式，求出body
frame在實驗者處在的靜止%
座標的變化。因此現%
在我們設定一個真正%
的靜止座標Lab frame\thinspace ，見%
圖\ref{szsbtdtfig}，此為真正的%
觀測者所處在的inertial frame%
。考慮任意一段微小%
轉動t到t+dt，在t時刻時%
我們將剛體的principle axes設%
定為S frame，再將t+dt時刻剛%
體的principle axes設定為b frame，這%
樣代表s frame到b frame就是剛%
體t到t+dt的轉動，並且s%
到b frame的瞬時角速度也%
是剛體轉動的瞬時角%
速度。我們重新將\ref{vecrot}%
式寫成%
\begin{equation}
\hat{y}_{s}\left( t+dt\right) =\underset{\text{active, r.h.}}{CK\left( \vec{%
\omega}_{s}\left( t\right) dt\right) }\times \hat{y}_{s}\left( t\right)
\label{vecrot05}
\end{equation}%
$\hat{y}_{s}\left( t\right) $現在為t時間%
剛體特徵軸$\hat{y}$在s frame(也%
是t時刻)的投影，這代%
表$\hat{y}_{s}\left( t\right) $即為單位向%
量$\left[ 
\begin{array}{ccc}
0 & 1 & 0%
\end{array}%
\right] $。現在我們再將上%
式寫成%
\begin{equation}
\hat{y}_{s}\left( t_{i+1}\right) =\underset{\text{active, r.h.}}{CK\left( 
\vec{\omega}_{s}\left( t_{i}\right) \Delta t\right) }\times \left[ 
\begin{array}{ccc}
0 & 1 & 0%
\end{array}%
\right]  \label{vecrot1}
\end{equation}

\begin{figure}[th]
\caption{Boby軸在每一分段t到t+dt%
的追蹤示意圖。}
\begin{center}
\fbox{\input{Zt0Zt1.pgf}}
\end{center}
\end{figure}

\begin{figure}[th]
\caption{陀螺的初始值設定%
。此初始值設定對應%
的尤拉角初始值﹝以$%
z-x^{\prime }-z^{\prime }$為轉軸順序分%
別以右手定則轉動$\protect%
\phi $，$\protect\theta $，$\protect\varphi $﹞為$%
\protect\phi _{0}=0$，$\protect\theta _{0}=-\left\vert \hat{\Omega}%
_{0}\right\vert $，$\protect\varphi _{0}=0$。在Hasbun%
教授的尤拉解法中需%
要此尤拉角初始值，%
來給出與我們方向餘%
弦法相同的初始條件%
。}
\begin{center}
\fbox{\input{orien.pgf}}
\end{center}
\end{figure}

假設陀螺特徵軸在lab frame%
的起始位置已知$\hat{x}\hat{y}\hat{z%
}_{lab}(t_{0})$，初始貼體角速%
度已知$\vec{\omega}_{s}(t_{0})$，$\hat{x}\hat{y}\hat{%
z}$的下標代表的是觀測%
的frame。首先我們將s frame放%
在$\left( \hat{x}\hat{y}\hat{z}_{lab}(t_{0})\right) $，這%
樣依照圖\ref{szsbtdtfig}及其所%
述原理，b frame的軸就是%
我們要求的$\hat{x}\hat{y}\hat{z}_{lab}(t_{1})$%
。我們先看$\hat{z}$軸，\ref%
{vecrot1}式告訴我們%
\begin{equation*}
\hat{z}_{0}\left( t_{1}\right) =\underset{\text{active, r.h.}}{\left[
CK\left( \vec{\omega}_{s}\left( t_{0}\right) dt\right) \right] }\times \hat{z%
}_{0}\left( t_{0}\right) \underset{\text{active, r.h.}}{=\left[ CK\left( 
\vec{\omega}_{s}\left( t_{0}\right) dt\right) \right] }\times \left[ 
\begin{array}{ccc}
0 & 0 & 1%
\end{array}%
\right]
\end{equation*}%
其中$\hat{z}_{0}\left( t_{0})\text{，}\hat{z}%
_{0}(t_{1}\right) $代表時間為$t_{0}$與$%
t_{1}$的\^{z}軸在$t_{0}$時間的座%
標軸(也就是s frame)的投影%
，因此$\hat{z}_{0}\left( t_{0}\right) $為單%
位向量$\left[ 
\begin{array}{ccc}
0 & 0 & 1%
\end{array}%
\right] $。這樣子我們求得%
下一個z軸的位置在$t_{0}$%
的投影，不過我們得%
轉回lab frame，我們假設lab frame%
的$xyz$軸到陀螺初始位置%
$\hat{x}\hat{y}\hat{z}_{lab}(t_{0})$的轉動向量%
是$\vec{\Omega}_{0}， $這樣我們可%
以用$\vec{\Omega}_{0}$輕易的改變%
陀螺初始位置，運用%
上\ref{frametrans}式%
\begin{equation*}
\hat{z}_{lab}\left( t_{1}\right) =\underset{\text{passive, l.h.}}{\left[
CK\left( \vec{\Omega}_{0}\right) \right] }\times \hat{z}_{0}\left(
t_{1}\right)
\end{equation*}%
注意這邊矩陣就取被%
動含意，結合以上兩%
式得到%
\begin{eqnarray*}
\hat{z}_{lab}\left( t_{1}\right) &=&\underset{\text{passive, l.h.}}{\left[
CK\left( \vec{\Omega}_{0}\right) \right] }\underset{\text{active, r.h.}}{%
\left[ CK\left( \vec{\omega}_{s}\left( t_{0}\right) dt\right) \right] }%
\times \hat{z}_{0}\left( t_{0}\right) \\
&=&\underset{\text{passive, l.h.}}{\left[ CK\left( \vec{\Omega}_{0}\right) %
\right] }\underset{\text{active, r.h.}}{\left[ CK\left( \vec{\omega}%
_{s}\left( t_{0}\right) dt\right) \right] }\times \left[ 
\begin{array}{ccc}
0 & 0 & 1%
\end{array}%
\right]
\end{eqnarray*}%
這樣我們就從t$_{0}$時間%
得到t$_{1}$時間陀螺z軸的%
位置。

接著若我們知道$\hat{z}_{lab}\left(
t_{i}\right) $，再從尤拉方程%
數值法解出的$\vec{\omega}_{s}\left(
t_{0},t_{1},\cdots ,t_{i}\right) $(接下來會說%
明)，我們同樣可以求%
得$\hat{z}_{lab}\left( t_{i+1}\right) $，首先用%
\ref{vecrot}式%
\begin{eqnarray*}
\hat{z}_{i}\left( t_{i+1}\right) &=&\underset{\text{active, r.h.}}{\left[
CK\left( \vec{\omega}_{s}\left( t_{i}\right) dt\right) \right] }\times \hat{z%
}_{i}\left( t_{i}\right) \\
&=&\underset{\text{active, r.h.}}{\left[ CK\left( \vec{\omega}_{s}\left(
t_{i}\right) dt\right) \right] }\times \left[ 
\begin{array}{ccc}
0 & 0 & 1%
\end{array}%
\right]
\end{eqnarray*}%
再用\ref{frametrans}式轉回到lab frame%
\begin{eqnarray}
\hat{z}_{lab}\left( t_{i+1}\right) &=&\underset{\text{passive, l.h.}}{%
\underbrace{\left[ CK\left( lab\rightarrow t_{i}\right) \right] }}\times 
\hat{z}_{i}\left( t_{i+1}\right)  \notag \\
&=&\underset{\text{passive, l.h.}}{\underbrace{\left[ CK\left( \vec{\Omega}%
_{0}\right) \cdot CK\left( \vec{\omega}_{s}\left( t_{0}\right) dt\right)
\cdot CK\left( \vec{\omega}_{s}\left( t_{1}\right) dt\right) \cdot \cdots
\cdot CK\left( \vec{\omega}_{s}\left( t_{i-1}\right) dt\right) \right] }}%
\times  \notag \\
&&\hat{z}_{i}\left( t_{i+1}\right)  \notag \\
&=&\underset{\text{passive, l.h.}}{\underbrace{\left[ CK\left( \vec{\Omega}%
_{0}\right) \cdot CK\left( \vec{\omega}_{s}\left( t_{0}\right) dt\right)
\cdot CK\left( \vec{\omega}_{s}\left( t_{1}\right) dt\right) \cdot \cdots
\cdot CK\left( \vec{\omega}_{s}\left( t_{i-1}\right) dt\right) \right] }}%
\times  \notag \\
&&\underset{\text{active, r.h.}}{\underbrace{\left[ CK\left( \vec{\omega}%
_{s}\left( t_{i}\right) dt\right) \right] }}\times \left[ 
\begin{array}{ccc}
0 & 0 & 1%
\end{array}%
\right]  \label{iterateeq0}
\end{eqnarray}%
這裡用上不同時間微%
小轉動矩陣的commutive性質$%
\left( AB\right) C=A\left( BC\right) $。這樣我%
們就得到了所有時刻$%
\left( t_{0},t_{1},\cdots ,t_{i+1}\right) $z軸在lab frame位%
置的公式，同樣方法%
可求得x,y軸。可以看出%
上面所有passive的矩陣的%
作用只是再把坐標軸%
從body frame轉回到lab frame。若我%
們再用上轉動矩陣相%
乘即等於轉動向量相%
加的事實\cite{goldstein}，上式%
也可寫成%
\begin{equation}
\hat{z}_{lab}\left( t_{i+1}\right) ==\left[ CK\left( \vec{\Omega}%
_{0}+\sum\limits_{m=0}^{i}\vec{\omega}_{s}\left( t_{m}\right) \right) \right]
\times \left[ 
\begin{array}{ccc}
0 & 0 & 1%
\end{array}%
\right]  \label{iterateeq2}
\end{equation}%
不過要注意，只有CK內%
包含的所有轉動向量%
都是要微小轉動向量%
此條公式才會成立。%
﹝在我們的Python程式中%
也包含有使用此公式%
的選項，讀者可以自%
由切換比較。用此公%
式的好處是，矩陣的%
相乘轉換成了矩陣的%
相加，在速度及記憶%
體的佔用上此近似會%
有優勢。不過，程式%
預設是使用\ref{iterateeq0}公式%
，因$\vec{\Omega}_{0}$量值不小。%
﹞另外這邊我們就省%
略了矩陣的主被動左%
右手的標示，但注意%
，我們的CK矩陣是定義%
右手定則，遵守物理%
定律。這裡若不強調%
會產生問題，因為很%
多書上給的是CK是左手%
公式。並且，若要了%
解公式，主被動及左%
右手的標示是必須保%
留並且對照圖表才有%
辦法了解公式如何而%
來以及轉動方向是如%
何，而這也是大部分%
書上所缺乏的。這樣%
，我們就得到了剛體%
特徵軸的追蹤公式，%
並且只要知道"貼體"角%
速度﹝注意並不是角%
速度在lab frame的觀察值，%
當然如果知道這個，%
我就不用寫這麼多了%
。﹞就可以求得。同%
理可得$\hat{x}_{lab}\left( t_{i+1}\right) $，$\hat{y}%
_{lab}\left( t_{i+1}\right) $。

若將$\hat{x}_{lab}\left( t_{i+1}\right) $，$\hat{y}%
_{lab}\left( t_{i+1}\right) $，$\hat{z}_{lab}\left( t_{i+1}\right) $%
的三個行組成一矩陣C%
，我們會發現\ref{iterateeq2}式%
即為導航書籍上常看%
到的方向餘弦遞推理%
論的姿態矩陣動力方%
程\cite{titterton}%
\begin{eqnarray}
C(t_{i+1}) &=&C(t_{i})\exp (\int \omega dt)  \label{iterationC} \\
\dot{C}(t_{i+1}) &=&C(t_{i})\times \omega (t)
\end{eqnarray}%
不過似乎沒有人願意%
花時間把此公式解釋%
清楚，比如說，\ref{iterateeq0}%
式若不經過我們每一%
步轉動矩陣都紀錄並%
寫下主被動與左右手%
性質，實際應用的時%
候我們將不知道是否%
要套用transpose矩陣而胡亂%
套用(很常發生)，轉動%
向量的主動還是坐標%
系的被動特性以及轉%
動方向遵守是左手還%
是右手定則，這樣將%
造成實際應用時極大%
的困擾。因此我們知%
道，只給出\ref{iterationC}公式%
只是一小步，離實作%
層面還有非常大一段%
距離。此式中$\exp (\int \omega dt)$%
為path order exponential，關於此，%
以及要如何證明$\exp (\int \omega
dt)$是我們的CK矩陣，可%
以在\cite[Page 49]{tong}找到，並注%
意連結與$\sin $，$\cos $的泰%
勒展開的關係。

\bigskip

以上為轉動坐標系中%
的向量變化量與恆定%
坐標系中的向量變化%
量與轉動坐標系的角%
速度的關係推導，不%
過我們發現我們必須%
要知道所有時刻的貼%
體角速度$\vec{\omega}_{s}\left( t_{0}\cdots
t_{i}\right) $。若是在慣性感%
測器的應用，由於strap-down%
﹝捷聯式or綁附式﹞慣%
性感測器﹝IMU, inertial measurement unit%
﹞測量得的就是貼體%
角速度，因此我們可%
以直接將測量值帶入%
我們的公式，這就是%
捷聯式慣性感測器姿%
態估測演算法的一種%
演算法，也就是我們%
程式的C方法，我們會%
在第四部分說明。另%
一種方法是，我們也%
可以利用尤拉方程以%
遞推的方式數值求出$%
\vec{\omega}_{s}\left( t_{0}\cdots t_{i}\right) $，並且%
每遞推一次就以當前%
的$\vec{\omega}_{s}$更新陀螺的姿%
態，然後再以尤拉方%
程去遞推下一個$\vec{\omega}_{s}$%
，再更新陀螺的姿態%
，反覆遞推就會得到%
所有時刻的運動，此%
法為A方法，接下來我%
們將詳細說明此A方法%
。

\bigskip

將\ref{rateofchange}式應用上一段s%
到b frame，t到t+dt的微小轉動%
，並且考慮$\vec{A}$為剛體%
角動量$\vec{L}$，則我們得%
到%
\begin{equation}
\left( \Gamma \right) _{s}=\left( \frac{d\vec{L}}{dt}\right) _{s}=\left( 
\frac{d\vec{L}}{dt}\right) _{b}+\left( \vec{\omega}\right) _{s}\times \left( 
\vec{L}\right) _{s}  \label{liw}
\end{equation}%
這裡第一等號也用上%
牛頓定律。現在我們%
從\ref{rateofdomega}式知道$\left( d\vec{\Omega}%
\right) _{s}$是s到b frame的角位移，%
而經由我們之前剛體%
特徵軸的設定，s到b frame%
正是我們剛體特徵軸%
從t到t+dt的角位移，因此%
$\left( \frac{d\vec{\Omega}}{dt}\right) _{s}=\left( \vec{\omega}\right) _{s}$%
正是剛體的瞬時角速%
度﹝沿著t時間s frame取分%
量﹞，接著，因為s, b frame%
都是沿著body principle axes而取，%
因此沿s frame的角動量$\left( \vec{L%
}\right) _{s}$可以寫成%
\begin{equation*}
\left( \vec{L}\right) _{s}=\left[ 
\begin{array}{ccc}
I_{xx} & 0 & 0 \\ 
0 & I_{yy} & 0 \\ 
0 & 0 & I_{zz}%
\end{array}%
\right] \times \left( \vec{\omega}\right) _{s}
\end{equation*}%
並且沿著b frame的$\left( \frac{d\vec{L}}{dt}%
\right) _{b}$項也可寫成%
\begin{equation*}
\left( \frac{d\vec{L}}{dt}\right) _{b}=\left[ 
\begin{array}{ccc}
I_{xx} & 0 & 0 \\ 
0 & I_{yy} & 0 \\ 
0 & 0 & I_{zz}%
\end{array}%
\right] \times \frac{d\left( \vec{\omega}\right) _{b}}{dt}
\end{equation*}%
其中$I_{xx}$、$I_{yy}$、$I_{zz}$都不%
隨時間變動。再次注%
意$\left( \Gamma \right) _{s}$與$\left( \vec{\omega}\right) _{s}$%
與$\left( \vec{L}\right) _{s}$都是沿著t時%
刻的剛體特徵軸(也就%
是s frame)取的投影，並不%
是Lab frame的投影，這點要%
特別注意，基本上這%
代表，$\left( \Gamma \right) _{s}$是貼體%
的力矩，這裡也給出%
了文章開頭問題的解%
答！這裡大部分的書%
上都沒有給出恰當的%
原因，就連Goldstein在書中%
也只有說向量沿著任%
意座標取分量都可以%
，不過這並無法合理%
解釋，事實上是，我%
們假設了t時間s與b frame重%
和﹝Goldsten的證明也是採%
用此假設\cite{goldstein}，我這%
裡只是將Goldstein上面的證%
明用淺顯的線性代數%
重新表達。﹞，見\ref{roc1}%
式，因此s frame是隨時間%
一直變動。如果用lab frame%
的$\Gamma $那麼就無法成功%
的數值化喔\footnote{注意因%
為s frame會持續的改變所%
以$\left( \vec{\Gamma}\right) _{s}$不可取$\left( 
\vec{\Gamma}\right) _{lab}$的值，同理$\left( 
\vec{\omega}\right) _{s}$也不是$\left( \vec{\omega}\right)
_{lab}$，兩者都必須經過%
轉換從lab轉到t時刻s frame。}%
。這邊我們證明了\ref{liw}%
式最後那一項中的兩%
個$\vec{\omega}$是相同的\footnote{但%
我們必須強調，任意%
情況下，角速度$\left( \vec{\omega}%
\right) $在body轉動座標下的投%
影並不是body座標上觀察%
到的角速度！這是很%
常見的錯誤，這裡我%
們是有條件的考慮t到t+dt%
時刻的t時刻s,b座標重和%
。}。$\frac{d\left( \vec{\omega}\right) _{b}}{dt}$即%
是$\frac{d\vec{\omega}_{b}(t+dt)-d\vec{\omega}_{s}(t)}{dt}$，%
由於s與b frame都是剛體特%
徵軸，都是貼體座標%
軸，只是在不同時間%
，以此展開\ref{liw}式，我%
們就得到所謂的牛頓%
尤拉公式(Newton-Euler's equation)，或%
簡稱尤拉公式。%
\begin{eqnarray}
\Gamma _{x}(t) &=&I_{x}\dot{\omega}_{x}+(I_{z}-I_{y})\omega _{y}\left(
t\right) \omega _{z}\left( t\right)  \notag \\
\Gamma _{y}(t) &=&I_{y}\dot{\omega}_{y}+(I_{x}-I_{z})\omega _{x}\omega _{z}
\label{eulereqbody} \\
\Gamma _{z}(t) &=&I_{z}\dot{\omega}_{z}+(I_{x}-I_{y})\omega _{x}\omega _{y} 
\notag
\end{eqnarray}%
其中$\vec{\omega}=\left[ 
\begin{array}{ccc}
\omega _{x} & \omega _{y} & \omega _{z}%
\end{array}%
\right] $。注意$\vec{\Gamma}$及$\vec{\omega}$的%
x,y,z分量都是沿著t時刻%
的剛體特徵軸s frame取的%
分量，這點必須要再%
次強調。之後數值模%
擬的時候這點是非常%
重要的。基本上可以%
說，尤拉方程是我們%
假設\ref{roc1}式後所作的一%
種線性代數變換近似%
。

\bigskip

接下來應用上陀螺，%
若考慮陀螺的條件 $%
I_{x}=I_{y}\neq I_{z}$，\ref{eulereqbody}式可寫%
成%
\begin{equation}
\frac{d}{dt}\left[ 
\begin{array}{c}
\omega _{x} \\ 
\omega _{y} \\ 
\omega _{z}%
\end{array}%
\right] =\left[ 
\begin{array}{ccc}
0 & -\frac{I_{z}-I_{y}}{I_{x}}\omega _{z} & 0 \\ 
-\frac{I_{x}-I_{z}}{I_{y}}\omega _{z} & 0 & 0 \\ 
0 & 0 & 0%
\end{array}%
\right] \left[ 
\begin{array}{c}
\omega _{x} \\ 
\omega _{y} \\ 
\omega _{z}%
\end{array}%
\right] +\left[ 
\begin{array}{c}
\frac{\Gamma _{x}}{I_{x}} \\ 
\frac{\Gamma _{y}}{I_{y}} \\ 
\frac{\Gamma _{z}}{I_{z}}%
\end{array}%
\right] 
\end{equation}%
如之前所強調，右邊%
所有項都是在時間為t%
時刻的s frame取得值，也%
因此以上的微分方程%
組可以用普通數值由%
拉法或四階Ruge Kutta求出左%
側$\vec{\omega}_{b}(t+dt)$，也就是從$%
\vec{\omega}_{s}(t)$求得$\vec{\omega}_{b}(t+dt)$，而$%
\vec{\omega}_{b}(t+dt)$就是下一時間%
的$\vec{\omega}_{s}(t)$。不過對於任%
意的剛體轉動系統，%
只要能從\ref{eulereqbody}式右側$%
\vec{\omega}_{s}(t)$求得左側$\vec{\omega}_{b}(t+dt)$%
，都還是能夠適用接%
下來的模擬方法，也%
因此這裡描述的方法%
是具有任意一般性的%
，可以應用在任何的%
剛體轉動，包括asymmetric rotor%
的情況。有不少的數%
值方法可以解一般的%
非線性一階ODE尤拉方程%
\cite{matlab}。這裡我以Ruge Kutta四%
階法求解上式，來得%
到$\vec{\omega}_{s}\left( t_{0}\cdots t_{i}\right) $，並%
且寫成python程式，程式%
將在下一章介紹。這%
裡所使用的方法與原%
子分子運動模擬中的%
方法雷同，可以參考\cite%
{rapaport}。

\begin{figure}[th]
\caption{陀螺的對稱軸的單%
位向量的模擬軌跡圖%
。以$\protect\omega (t_{i})$或$\protect\omega (t_{i+1})$%
轉動向量來近似$t_{i}$到$%
t_{i+1}$時間的轉動的模擬%
結果，並與Hasbun教授的%
數值解B法比較。$\protect\omega %
(t_{i+1})$的結果與Hasbun教授的%
結果在此圖形中幾乎%
重疊，這代表以$\protect\omega %
(t_{i+1})$來近似比$\protect\omega (t_{i})$好%
很多。}
\label{wtiwti1}
\begin{center}
\fbox{\input{wti_wtiplus1.pgf}}
\end{center}
\end{figure}

\section{以$t_{i+1}$時間的轉動向%
量來近似$t_{i}$到$t_{i+1}$的轉%
動}

\bigskip

以上\ref{vecrot05}式中以$CK\left( \vec{\omega}%
_{s}(t_{i})dt\right) $來近似t$_{i}$到t$_{i+1}$%
的轉動事實上還不夠%
好，圖\ref{wtiwti1}顯示，以$\omega
(t_{i})$轉動向量近似的結%
果與Hasbun的正確結果偏%
差不少。這邊我提出%
以$CK\left( \vec{\omega}_{s}(t_{i+1})dt\right) $來近%
似t$_{i}$到t$_{i+1}$的轉動，圖\ref%
{wtiwti1}顯示模擬結果幾乎%
與Hasbun的正確解重合，%
至少此圖表上無法看%
出任何差別。為什麼%
有如此大的影響，以%
下我也嘗試提供物理%
解釋。這裡我們暫時%
假設$\vec{\omega}_{s}(t_{i})dt=\vec{\Omega}_{s}(t_{i})$，%
我們知道轉動向量在$%
t_{i+1}$跟$t_{i}$時刻在body frame中的%
向量值一般不會一樣%
，也就是$\vec{\Omega}_{i+1}(t_{i+1})\neq \vec{\Omega}%
_{i}(t_{i})$，這代表從$t_{i}$到$t_{i+1}$%
時，轉動向量在body座標%
上有變化，也因此我%
們不能夠單只考慮陀%
螺轉了$\vec{\Omega}_{s}(t_{i})$而已，%
此額外轉動向量的變%
化在$t_{i}$時s frame的向量值%
為$\Omega _{i+1}(t_{i+1})-\Omega _{i}(t_{i})=\Omega
_{i}(t_{i})+d\Omega _{i}(dt)-\Omega _{i}(t_{i})=d\Omega _{s}(dt)$，%
也是一個轉動向量，%
所以space空間中總共的轉%
動可以考慮成兩步，%
第一步轉$\Omega _{s}(t_{i})$，第二%
步轉$d\Omega _{s}(dt)$，寫成轉動%
矩陣%
\begin{equation}
CK(\Omega _{s}(t_{i}))\times CK(d\Omega _{s}(dt))=CK(\Omega
_{s}(t_{i})+d\Omega _{s}(dt))=CK(\Omega _{i+1}(t_{i+1}))
\end{equation}%
這代表我們只要考慮%
陀螺從t到t+dt的時候是轉%
了$\Omega _{s}(t+dt)$而不只是$\Omega _{s}(t)$%
，因此考慮$\Omega _{s}(t+dt)$我們%
就更準確的近似了這%
個轉動，以下的Python程%
式模擬會證明，考慮%
了$\Omega _{s}(t+dt)$給出的結果比$%
\Omega _{s}(t)$好非常多。若如%
此考慮則\ref{iterateeq0}式變成%
\begin{eqnarray}
\hat{z}_{lab}\left( t_{i+1}\right) &=&\left[ CK\left( \vec{\Omega}%
_{0}\right) \cdot CK\left( \vec{\omega}_{s}\left( t_{1}\right) dt\right)
\cdot CK\left( \vec{\omega}_{s}\left( t_{2}\right) dt\right) \cdot \cdots
\cdot CK\left( \vec{\omega}_{s}\left( t_{i+1}\right) dt\right) \right] \times
\notag \\
&&\left[ 
\begin{array}{ccc}
0 & 0 & 1%
\end{array}%
\right]  \label{iterationCK}
\end{eqnarray}%
此公式即為我Python程式%
中使用的DCM遞推的公式%
。相同方法可求得另%
外兩軸x,y的運動。

\bigskip

使用$\omega (t+dt)$來做t時間的%
轉動近似讓我們的程%
式碼變得非常簡單，%
比書中\cite[Page 301, Equation 10.24]{titterton}給%
出的轉動向量近似公%
式簡單太多了。簡單%
的程式碼代表之後在%
做速度優化，或轉寫%
成速度快的編譯式語%
言上，會簡單非常多%
。若需要更精確的近%
似，書\cite[Page 301, Equation 10.24]{titterton}中%
也給出轉動向量的近%
似公式，不過此公式%
頗為複雜，因此這邊%
先嘗試比較以我們$\vec{\omega}%
_{s}(t_{i+1})$方法與解析解的%
不同。下面就將上述%
方法寫成python程式，以%
尤拉方程數值解出貼%
體角速度，接著用遞%
推公式\ref{iterationCK}畫圖模擬%
其xyz軸運動。這邊劃出%
四種陀螺的經典運動%
，其模擬參數請參考%
下一章節的參數預設%
值。程式產生的3D動畫%
的演示請參考以下連%
結。

\begin{center}
\href{http://tinypic.com/r/wk20ch/8}{\underline{\color{blue}%
\smash{3D
animation: http://tinypic.com/r/wk20ch/8}}}
\end{center}

\begin{figure}[th]
\caption{{}左到右: (a) 尖點 (b) 環%
狀 (c) 波紋 (d) 正圓運動。}
\label{FourClassics}
\begin{center}
\fbox{\scalebox{1.2}[1.2]{\input{FourClassics.pgf}}}
\end{center}
\end{figure}

%TCIMACRO{\TeXButton{clearpage}{\clearpage}}%
%BeginExpansion
\clearpage%
%EndExpansion

\part{方向餘弦演算法Python程%
式碼之說明}

\setcounter{page}{1}\bigskip

\bigskip

程式經過幾次升級修%
改後，目前已經以物%
件導向方式編寫完成%
。主要是環繞著一個%
類別﹝class﹞名為RigidBodyObject來%
發展。此類別的宣告%
及其方法﹝演算法的%
主程式﹞被包在一個%
套件module裡，此套件為%
RGCordTransVXX.py檔，使用前先import
RGCordTransVXX，XX代表目前的版%
本。動畫及圖表產生%
的程式是整合在RBPlotFuncVXX.py%
此module檔中，因此也要import%
此module。我使用的Python版本%
為Python 2.7.5 - Anaconda 1.8.0 (32-bit)，NumPy 1.7.1，%
SciPy 0.13.0，Matplotlib 1.3.1。不同版本%
的Python﹝如Python 3.x﹞會有一%
些指令的不同可能要%
做小修改，可以聯絡%
我我可以幫忙做修正%
。\texttt{使用者可可調整%
的}參數列在文件最後%
的程式使用說明書中%
。說明書名稱是GyroSoft Simulation
Documentation。以下為如何使用%
程式的一個最簡單範%
例，以及其輸出的陀%
螺動畫，我們將此範%
例存成一個Gyroscope-Demo.py檔，%
使用的時候只要執行%
此檔就可以，裡面的%
內容如下:

\bigskip

\definecolor{bg}{rgb}{0.95,0.95,0.95}%
%TCIMACRO{%
%\TeXButton{code example}{\begin{mdframed}[leftline=false, rightline=false,backgroundcolor=bg]
%\inputminted[linenos,fontsize=\footnotesize]{python}{../../Scripts/cordtrans/Gyroscope-Demo-LatexImport.py}
%\end{mdframed}}}%
%BeginExpansion
\begin{mdframed}[leftline=false, rightline=false,backgroundcolor=bg]
\inputminted[linenos,fontsize=\footnotesize]{python}{../../Scripts/cordtrans/Gyroscope-Demo-LatexImport.py}
\end{mdframed}%
%EndExpansion
\bigskip

模擬程式畫出剛體特%
徵軸的x, y, z軸單位向量%
，分別為藍紅綠線段%
，我們以一個正方形%
來代表剛體，正方形%
的中心點定在z軸的二%
分之一處，由於Python的%
Matplotlib三維繪圖程式庫mplot3d%
並沒有太多的3D繪圖支%
援，因此這邊只是以%
一個簡單的示意的正%
方形來代表陀螺，之%
後我也考慮將模擬結%
果輸出至專門做3D rendering的%
繪圖程式語言，如openGL%
，來做更精美的陀螺%
外觀。z軸單位向量的%
頂點對時間的軌跡圖%
，也就是locus，是以藍色%
的曲線表示。Hasbun教授%
的尤拉角法給出的z軸%
單位向量的locus，是以黑%
色的曲線表示。另外%
剛體的總角動量的單%
位向量以黑色線段表%
示，剛體的角速度除%
以角速度初始值量值%
的normalized向量以綠色線段%
表示。

\begin{figure}[th]
\caption{模擬條件(SI units): I=0.002; Is=0.0008;
g=9.8; M=1 ; arm=.04; spin freq= 20 Hz; Initial angle from vertical 54.57
degree; Sampling rate 2000 Hz.}
\begin{center}
\fbox{\input{AnimationFig.pgf}}
\end{center}
\end{figure}

\bigskip

如之前所提到，程式%
有三種不同的模擬陀%
螺運動的方法，可以%
互相比較互相驗證。%
這三種方法各自有其%
應用領域，我們會詳%
細解釋。這三種方法%
的流程圖我們整理在%
圖\ref{ABCmethodsIllustration}中，這樣可%
以幫助我們清楚的了%
解其差異性。

\begin{figure}[th]
\caption{Python程式所包含的ABC三%
種姿態解算法示意圖%
。}
\label{ABCmethodsIllustration}
\begin{center}
\input{testPSTricks-flowchartV2-insert.tex}
\end{center}
\end{figure}

\bigskip

首先A方法為，數值解%
轉動座標的貼體角速%
度的尤拉方程﹝牛頓%
尤拉方程﹞，從初始%
值得到下一個貼體角%
速度，並以此貼體角%
速度依照第一章節推%
導的方向餘弦遞推公%
式\ref{iterationCK}求得下一個姿%
態，再以此姿態回到%
貼體尤拉方程解出下%
一個貼角，也就是重%
複以上步驟。這樣可%
以得到剛體xyz軸的運動%
﹝這邊我們是討論應%
用於陀螺的運動﹞。%
此方法我們姑且稱為%
\emph{力矩已知的貼體尤%
拉方程的姿態遞推}，%
因為每一步遞推解貼%
體角速度時都需要知%
道貼體尤拉方程中的%
力矩項﹝這裡也呼應%
第一章我們所強調'貼%
體'力矩的證明是有其%
重要性﹞，而陀螺的%
力矩是我們已知的重%
力而來。由於此A方法%
是一種轉動向量的堆%
疊近似，因此會有誤%
差，而我們想要知道%
這誤差有多大，因此%
我們會跟以下的B方法-%
也就是傳統的數值解%
尤拉角尤拉方程﹝代%
入尤拉角後的牛頓尤%
拉方程﹞做比較。A方%
法以四階Runge Kutta直接數值%
解陀螺尤拉方程﹝%
topEOM(wi,torquei)\texttt{﹞}得到貼體角%
速度，接著用遞推公%
式\ref{iterateeq0}來得到陀螺特%
徵軸xyz軸的單位向量cordvec%
對時間的變化。cordvec陣%
列的維度shape=(N,3,7)\texttt{。其中%
維度為}7\texttt{的方向的首%
要三個陣列就是}xyz\texttt{軸%
。}DCM遞推的程式在DCMiter方%
程裡。

\bigskip

B方法，\emph{數值解尤拉%
角尤拉方程}，就是將%
牛頓尤拉方程中的貼%
體角速度代換成尤拉%
角，然後進行ODE數值解%
。由於牛頓尤拉方程%
本身就呈現非線性，%
代入尤拉角後得到的%
微分方程組更是呈現%
高度非線性，因此取%
樣時間需要縮短來防%
止數值解發散。並且%
，解尤拉角尤拉方程%
組在$\theta =0^{\circ }$時因為會除%
以$\sin (\theta )$，因此在此角%
度附近會發散產生NaN的%
值。因此使用B方法時%
必須要遠離這個限制%
。不過，若ODE的取樣時%
間夠小﹝當計算量大%
，計算時間長並不是%
問題時﹞或誤差有作%
控制，此方法算是一%
種較精確的數值法，%
也因此我們將比較AB兩%
種方法給出的結果。

\bigskip

值得一提的是，B方法%
與使用Lagrange力學所得到%
的方程是可以reduce成一%
樣的微分方程組，所%
以基本上也可以說我%
們的B方法也是Lagrange法，%
關於如何證明兩個方%
法是一樣的，只要查%
詢Goldstein書上\cite[Page 216]{goldstein}的Equation
5-62與Eberly書上\cite[Page 158]{eberly}的Equation
3.50最終得到的是一樣的%
微分方程組即可得知%
。

\bigskip

B方法的程式碼來自Hasbun%
教授的著作\cite{hasbun}，不過%
他的程式碼是Matlab寫成%
，因此為了能跟我的%
python程式碼比較，我將%
他的程式重寫成python程%
式碼，此方程叫做%
HasbunEulerEquationODEsolve，列在最後的%
程式說明書中。補充%
一提，Hasbun教授所採用%
的尤拉角定義與我的%
相同，都是依照z-x'-z'軸%
依右手定則轉$\phi -\theta -\varphi $%
角，也與Goldstein書上相同%
，因此比較上會比較%
方便，不需要做轉換%
。Hasbun教授的程式碼是%
尤拉角所寫出來的，%
所以會有奇異點問題%
，$\theta $在零度時會產生NaN%
。

\bigskip

A方法可以適用於任意%
的陀螺狀態，因此不%
會遇到以尤拉角表達%
的方法所遇到在九十%
度角所遭遇的奇異點%
問題。不過，B方法只%
要ODE數值解收斂，結果%
會是比較正確的，因%
為A方法的姿態方向餘%
弦遞推是一種空間轉%
動向量的堆疊近似，%
因此會有誤差，而B方%
法不會有此問題。當%
然，A方法適用任意的%
剛體轉動方程，可直%
接套用，而B的尤拉角%
法還得要人為的將力%
矩項以尤拉角表達，%
之後才能進行數值解%
，因此要看力矩項的%
複雜程度，因此各有%
其適用場合。

\bigskip

第三種C方法是，在我%
們從B方法得到尤拉角%
隨時間的數值解後，%
我們可以將尤拉角數%
值解轉到body frame計算出貼%
體角速度的數值解，%
這樣我們會得到一組$%
\omega _{b}(t_{i})$，$i=1\symbol{126}N$，接著我%
們可以用方向餘弦公%
式\ref{iterateeq0}一個一個把$t_{0}%
\symbol{126}t_{N}$的姿態求出來﹝%
或者說將$\omega _{b}(t_{i})dt$一個%
一個堆疊起來﹞。此%
方法適用的情形是，%
若只知道貼體角速度%
，力矩項未知，如飛%
機的姿態感測器，此%
時此方法是唯一可以%
估測物體姿態的方法%
。此法我們也說是以%
貼體角速度直接做姿%
態方向餘弦矩陣遞推%
法。這裡要注意與A方%
法不同的是，A方法有%
利用貼體尤拉方程以%
上一個姿態來計算下%
一個貼角，在以下一%
個貼角去求得新的姿%
態。因此A方法只要知%
道初始角速度，與外%
力力矩項的型式。C方%
法是只需要貼體角速%
度，不管是從量測得%
來，或者是從理論得%
來，C方法只負責姿態%
矩陣遞推。若加上噪%
音過濾，C方法即為角%
速度感測器解算姿態%
的公式，因此適用在%
感測器的姿態估測上%
面。因此我們這邊與B%
方法的比較也提供了%
一個平台，來驗證姿%
態估測演算的正確性%
與準確性。我們在下%
一章還會繼續討論姿%
態估測演算法。

\bigskip

我們將在範例與分析%
中詳細討論三種方法%
在四種經典運動中的%
表現，以及相互比較%
。

\section{A、C方法的理論驗證%
與第三方程式碼的比%
較}

與我們A方法非常接近%
的是Rapaport書上\cite[Page 232]{rapaport}的%
方向餘弦法，讀者只%
要留心比對即可觀察%
到兩者皆是微小轉動%
向量的應用，書上也%
有介紹另一種四元數%
法，我將會把我們的A%
方法的程式模擬結果%
﹝陀螺章動進動﹞與%
另一位Christian教授以四元%
數法寫成的完整的程%
式easy javascript simulation﹝同樣是陀%
螺的章進動模擬﹞作%
直接的系統性比較。(%
不過還有一個問題待%
解決：還不知道如何%
將Christian教授的Javascript運動結%
果作輸出。)

%TCIMACRO{\TeXButton{clearpage}{\clearpage}}%
%BeginExpansion
\clearpage%
%EndExpansion

\part{範例與分析}

\setcounter{page}{1}

以下的範例討論若是%
遇到我們沒有提到的%
參數，代表都是以預%
設值代入，使用者不%
須特別去改變，程式%
都有內建參數預設值%
。我們將參數的預設%
值列在table中。

\begin{equation*}
\text{%
%TCIMACRO{%
%\TeXButton{default parameter table}{\input{default_parameter_table.tex}}}%
%BeginExpansion
\input{default_parameter_table.tex}%
%EndExpansion
}
\end{equation*}

\begin{case}
方法A在尖點運動情況%
下，轉動頻率為1 Hz，$\theta
=1^{\circ }$情況下的陀螺動畫%
。
\end{case}

此範例是一個簡單的%
驗證若陀螺在幾乎不%
旋轉的情況﹝轉動速%
度只有1 Hz﹞，此情形相%
當於陀螺只受重力影%
響而有倒下的運動，%
因為我們的運動是只%
有假設陀螺與圓點的%
接觸點是固定不動的%
，我們並沒有地面來%
限制陀螺的運動，因%
此陀螺會如同單擺一%
樣，擺動到最低點後%
，再回復到原本的高%
度。

%TCIMACRO{%
%\TeXButton{case f0 1deg}{\begin{center}
%\input{./otherstuff/Case_f0_1deg_fig.tex}
%\end{center}}}%
%BeginExpansion
\begin{center}
\input{./otherstuff/Case_f0_1deg_fig.tex}
\end{center}%
%EndExpansion

\begin{case}
方法A在尖點運動下，$%
\theta =55^{\circ }$情況，重力常數%
改為g=20 $m/s^{2}$，的陀螺運%
動。
\end{case}

另一個簡單的範例，%
示範如何任意更改重%
力常數，同法可應用%
於更改其他常數，可%
更改的常數請參考文%
件最後的說明書中Rigid Body
Class的user adjustable parameters。重力增%
加後，明顯的尖點跟%
尖點中間的弧線運動%
區段變大變長了，這%
是很合理的。

%TCIMACRO{%
%\TeXButton{case g20}{\begin{center}
%\input{./otherstuff/Case_g20_fig.tex}
%\end{center}}}%
%BeginExpansion
\begin{center}
\input{./otherstuff/Case_g20_fig.tex}
\end{center}%
%EndExpansion

\begin{case}
這裡與實體陀螺儀做%
定性定量的觀察比較%
。，可以點選連結觀%
察我們用gyroscope.com公司所賣%
的陀螺儀所製作的影%
片\href{http://tinypic.com/r/2clcee/8}{\underline{\color{blue}%
\smash{http://tinypic.com/r/2clcee/8}}}，觀察四%
種經典章動進動運動%
。然後再用以下的模%
擬code，模擬在相同的條%
件下，在電腦上觀察%
同樣四種章進動運動%
，並比較討論。我們%
可以觀察到，實體陀%
螺儀因有軸承摩擦存%
在而導致能量耗損很%
快，因此運動的damping很%
大，章進動的震幅只%
能持續幾秒就因阻尼%
而消失，電腦模擬就%
可以觀察到完整的運%
動。%
%TCIMACRO{%
%\TeXButton{real compare code plus fig}{\input{./otherstuff/Case_realcompare_fig.tex}}}%
%BeginExpansion
\input{./otherstuff/Case_realcompare_fig.tex}%
%EndExpansion
\end{case}

若要切換四種不同的%
經典運動，更改\texttt{b.setcase(1)}%
中的數字，1:尖點，2:環%
狀，3:波紋，4:正圓運動%
。若要更改陀螺初始%
的與space z軸的傾斜角，%
\texttt{b.orien =np.array([-np.radians(55),0,0])}中的數%
字即為角度in degree。由於%
陀螺儀有部分的質量%
是不繞行陀螺對稱軸%
轉動，如陀螺儀的鋁%
製外框，但這部分的%
質量還是會進行章動%
進動，因此跟理想上%
的理論假設有些微的%
差異。我們必須加入%
一個counter weight來描述這部%
分的質量的運動，這%
樣才能正確描述真實%
的運動。此counter weight質量%
是可以調整其量值大%
小，其質心到原點的%
距離，這樣一來我們%
可以做更真實且條件%
範圍更廣泛的測試陀%
螺運動。

\begin{case}
我們比較ABC法給出的陀%
螺$(1,1,1)$向量隨時間的變%
化，B方法由於是採用%
python的ode solver，此solver有確保%
其解有收斂(我們也可%
以調整\texttt{samplerate}來觀察B法%
結果確實不會有變化)%
，因此這邊我們將B法%
視為正確解，我們將%
觀察A與C法給出的$(1,1,1)$向%
量跟B法的差別，我們%
將畫出A法與B法給出的$%
(1,1,1)$向量間的夾角隨時%
間的變化(藍實線)，與C%
法與B法給出的$(1,1,1)$向量%
間的夾角隨時間的變%
化(紅虛線)。我們分別%
針對四種經典陀螺章%
動進動狀況作比較，%
此圖在圖\ref{ABCcompareFig}中。
\end{case}

\begin{figure}[th]
\caption{AB與BC法的$(1,1,1)$向量比%
較圖。}
\label{ABCcompareFig}
\begin{center}
\input{CompareDCMEulerAngle.pgf}
\end{center}
\end{figure}

我們發現在第一種尖%
點運動a狀況中A法表現%
很好，在20秒A方法都可%
以與B法保持在0.5度左右%
的偏移誤差，這在轉%
動向量積分法中表現%
算是非常好的，有實%
際應用的價值。b經典%
運動下也還可以，不%
過在cd兩種運動中就越%
來越差了，在cd這兩種%
波紋與正圓兩種經典%
運動下，A與C法(1,1,1)向量%
都偏移發散的非常快%
，五秒就已經到了100 degree%
，這邊在實際應用上%
就會有困難度。不過%
，若是我們仔細觀察%
動畫結果，看A方法給%
出的xyz軸是如何隨時間%
發散的，我們發現事%
實上z軸對稱軸A與B方法%
給出的差異是非常小%
的，差比較多的是x與y%
軸，這一點是有趣的%
，物理上的原因還在%
理解當中，但，在實%
際的應用上我們或許%
可以利用這一點，當%
我們知道我們是在cd兩%
種運動狀況下，我們%
會知道，雖然x與y軸不%
準，但z軸對稱軸會是%
比較準確的，因此當%
我們喪失xy軸準度，我%
們還可以相信z軸。因%
此我們也針對cd兩種經%
典運動畫出AB兩法給出%
的z軸間角度差異隨時%
間的變化。

\begin{figure}[th]
\caption{cd兩種經典運動下AB兩%
法給出的兩個z軸間的%
角度差異。}
\begin{center}
\frame{\input{AB_methods_cdCases_zaxis_compare.pgf}}
\end{center}
\end{figure}

C方法在cd兩種運動狀況%
表現的情況會在以下%
例子中討論。有趣的%
是，當$\theta =90^{\circ }$時，在d%
經典運動(正圓運動)情%
況下，C方法的結果非%
常準確，這將在以下%
例子中呈現。目前還%
在了解其不同章進動%
及不同角度下為何會%
給出不同的差異結果%
。

\begin{case}
BC方法在正圓運動下的%
比較，我們考慮C方法%
在兩個初始角度﹝$\theta
=55^{\circ }$and$\theta =90^{\circ }$﹞的準確性%
。圖\ref{BC_d_5590}分別劃出在%
兩個角度下BC方法解出%
的陀螺z軸的軌跡圖locus plot%
，與BC方法解出的兩組%
陀螺在最後時間的xyz軸(%
紅黃藍)，B組結果以實%
線劃出，C組結果以虛%
線畫出。我們會發現%
在55度的時候，C方法表%
現得並沒有很好，甚%
至可以說很差，但在90%
度的時候，C方法幾乎%
與B方法重合，表現得%
極好。這是非常有趣%
的一個現象，我還在%
嘗試理解為何在不同%
角度下C方法的準確度%
會有不同，若是能找%
出物理原因，我們說%
不定可以運用此現象%
於姿態控制當中，運%
用姿態解算法在某些%
特殊運動下會特別準%
確的優勢來做姿態控%
制。
\end{case}

\begin{figure}[th]
\caption{Comparing BC method in circular precession motion at two initial
angles.}
\label{BC_d_5590}
\begin{center}
\input{./otherstuff/Case_BC_d_90_element.tex}
\end{center}
\end{figure}

C方法在a運動狀況下在20%
秒內雖然誤差比A方法%
大(圖\ref{ABCcompareFig})，但是由於%
A方法的誤差會持續累%
積，因此在四十秒後A%
方法就會有較大的誤%
差了。同樣的在b運動%
狀況下也有類似的狀%
況，五秒內A方法比較%
好，五秒後C方法比較%
好。那麼C方法的誤差%
會不會累積呢？那我%
們就要加長模擬的時%
間。

\begin{case}
加長模擬時間來觀察C%
方法的發散度。
\end{case}

\begin{case}
比較C方法使用不同轉%
動向量來近似所產生%
的不同，可以改進cd兩%
種運動的估測準確度%
。
\end{case}

以下也列出ABC方法的優%
劣比較與適用場合

%TCIMACRO{%
%\TeXButton{ABC compare table}{\begin{center}
%\input{Table-Tabular-ABCcompare.tex}
%\end{center}}}%
%BeginExpansion
\begin{center}
\input{Table-Tabular-ABCcompare.tex}
\end{center}%
%EndExpansion

%TCIMACRO{\TeXButton{clearpage}{\clearpage}}%
%BeginExpansion
\clearpage%
%EndExpansion

\part{在綁缚式慣性感測%
器姿態演算的應用}

\setcounter{page}{1}

我們知道在姿態感測%
的應用上，若是轉動%
軸不隨時間而變化，%
則姿態估測上會容易%
且準確非常多。如汽%
車的航向陀螺儀姿態%
感測器，由於其大部%
分是在平面上轉彎運%
動，其轉動軸多在垂%
直方向，因此姿態的%
估測上是容易且準確%
的。但若是轉動軸會%
隨時間而變化，如同%
人體、飛機、或陀螺%
的姿態估測，其姿態%
的準確度隨時間而發%
散速度是很快的。一%
般在作轉動軸變化的%
姿態估測上都比較困%
難，一般都會融合其%
他感測方法，如GPS、地%
磁、重力來輔助姿態%
的判定。而此篇討論%
一個重點就是是否能%
夠在無其他融合感測%
方法時，對轉動軸變%
化的姿態估測的發散%
度有所歸納，我們以%
轉動速度相當快﹝轉%
動軸變化也快且大﹞%
的陀螺為測試平台，%
與陀螺的尤拉角尤拉%
方程數值解作系統性%
比較，來看看姿態估%
測演算法﹝C方法﹞在%
極端的轉動條件下，%
準確程度如何。並且%
討論為何四種經典章%
動進動會有不同的發%
散程度，以及是否我%
們可以利用發散程度%
較小的情況並作實際%
的應用。因此此物件%
導向化的軟體平台適%
合作為驗證，比較姿%
態估測演算法的平台%
。

\bigskip

上面的DCM的程式可以獨%
立出來應用在感測器%
的姿態估測上。由於DCM%
是考慮貼體角速度$\vec{\omega}
$，因此主要應用在綁%
缚式慣性感測元件﹝%
strap-down IMU﹞上，此類包含%
範圍涵蓋陀螺儀角速%
度感測器，微機電角%
速度感測器，等諸如%
此類的元件。只要把%
元件讀到的貼體角速%
度資料輸出，然後正%
確的輸入到我們這邊%
的DCM遞推程式，就可以%
得到物件轉動的姿態%
。這邊大部分的書籍%
都無法從原理說起，%
都只有提供公式，而%
且也很少詳細的說明%
公式如何使用。不過%
要補充的是，我這邊%
只有轉動部分，並沒%
有平移部分的演算法%
，不過轉動姿態是姿%
態估測的基礎，平移%
的演算是相對容易很%
多的。並且，這邊也%
沒有噪音過濾的功能%
，因為任何的量測儀%
器都會有噪音，因此%
在輸入DCM遞推前，必須%
先經過過濾。一般常%
見的過濾方法是卡爾%
曼濾波，噪音濾波的%
討論是我下一步的目%
標。

\bigskip

\begin{case}
C方法加上噪音後的靜%
止測試。
\end{case}

我們使用C方法來測試%
在此狀況下C方法給出%
的姿態隨時間的運動%
是否也是靜止的。假%
設貼體角速度是零加%
上一個隨機的噪音$\vec{\omega}%
(t)=0+Noise(t)$，$Noise(t)$為一固定Amplitude%
乘上-1到1的隨機數，固%
定的Amplitude單位為radian per second，%
量值大小可從\texttt{%
b.IncludeNoiseInOmega(5)}中的數字5更改%
。我們比較兩個Amplitude，%
產生此動畫的程式如%
下:

\bigskip

%TCIMACRO{%
%\TeXButton{case noise code}{\begin{mdframed}[leftline=false, rightline=false,backgroundcolor=bg]
%\inputminted[linenos,fontsize=\footnotesize]{python}{../../Scripts/cordtrans/sketch-NoiseIncludeInCMethod.py}
%\end{mdframed}}}%
%BeginExpansion
\begin{mdframed}[leftline=false, rightline=false,backgroundcolor=bg]
\inputminted[linenos,fontsize=\footnotesize]{python}{../../Scripts/cordtrans/sketch-NoiseIncludeInCMethod.py}
\end{mdframed}%
%EndExpansion

\bigskip

我們畫出z軸與Z軸隨時%
間的軌跡圖，我們這%
邊將兩個Amplitude的結果劃%
出，左邊是1 radian per sec，右%
邊是5 radian per sec。這樣我們%
就可以跟市面上賣的%
陀螺儀及angular rate sensor做比較%
。57.32 degree = 1 radian，所以我們%
這邊是考慮噪音很大%
的陀螺儀，或是陀螺%
儀在環境溫度變化或%
機械震動很大的極端%
的例子。

%TCIMACRO{%
%\TeXButton{case still noise}{\begin{center}
%\input{./otherstuff/Case_C_stillnoise_fig.tex}
%\end{center}}}%
%BeginExpansion
\begin{center}
\input{./otherstuff/Case_C_stillnoise_fig.tex}
\end{center}%
%EndExpansion

\bigskip

\begin{case}
C方法加上噪音後，經%
過running average的濾波方式，%
來測試尖點運動情況%
下的估測能力。
\end{case}

\bigskip

**need thinking即時解尤拉方程%
然後作DCM姿態遞推的好%
處是，不用事先知道%
力矩項，因此會比尤%
拉角尤拉方程方法更%
適用於力矩會隨時間%
變動或力矩為未知的%
情況，舉例來說，我%
們可以用在機器人的%
恣態控制上面，又或%
者，可以用在有用到%
剛體轉動的遊戲物理%
引擎上面。這些狀況%
都是尤拉角尤拉方程%
中的力矩項無法事先%
預知，因此無法事先%
解其尤拉角尤拉方程%
。又或者，若是力矩%
項太過複雜，如無人%
機的空氣動力，也適%
合使用我們這邊所介%
紹的即時解尤拉方程%
並作姿態遞推，只要%
有角加速度計可以測%
量角加速度就可以。%
我們這邊所介紹的陀%
螺，是一個應用的例%
子，由於陀螺的轉動%
速度是每秒20轉，因此%
轉動速度很高，對於%
姿態遞推的精度要求%
算很高，因此陀螺適%
合當作驗證姿態遞推%
演算的非常好的例子%
，若陀螺能算的準，%
其他轉動速度不高的%
情況將會非常準。陀%
螺的情況我們可以比%
喻為，把機器人或無%
人機丟入龍捲風裡面%
，並且要作姿態控制%
。

%TCIMACRO{\TeXButton{clearpage}{\clearpage}}%
%BeginExpansion
\clearpage%
%EndExpansion

\part{補充}

陀螺等周速運動Figure \ref%
{FourClassics}(d)的初始值條件如%
何計算呢?等周速的條%
件在Goldstein第二版5-77式給出%
\begin{equation}
Mgl=\dot{\phi}\left( I_{3}\omega _{3}-I_{1}\dot{\phi}\cos \theta _{0}\right)
\end{equation}%
，不過此式是由尤拉%
角(euler angles)給出，但我們%
需要的是anguler velocity along body的初%
始值，因此我們必須%
轉換尤拉角到anguler velocity along body%
，方法如下。上式中$%
\omega _{3}$即為我們的$\left( \omega
_{z}\right) _{b}$，比如說是20 Hz，$%
\theta _{0}$即為我們之前的orien%
向量所定，由上式可%
求出兩組$\dot{\phi}(t_{0})$。另外%
尤拉角跟anugler velocity along body的關%
係式在書\cite[Chapter 4, Equation 125]{goldstein} 
給出%
\begin{eqnarray}
(\omega _{x})_{b} &=&\dot{\phi}\sin \theta \sin \psi +\dot{\theta}\cos \psi
\\
(\omega _{y})_{b} &=&\dot{\phi}\sin \theta \cos \psi -\dot{\theta}\sin \psi
\\
(\omega _{z})_{b} &=&\dot{\phi}\cos \theta +\dot{\psi}
\end{eqnarray}%
知道$\dot{\phi}(t_{0})$、$\theta _{0}$、$\dot{\theta}%
_{0}=0$及$\psi _{0}$，用一二條後%
就可得到$\omega _{xb}(t_{0})$與$\omega
_{yb}(t_{0})$，這樣我們就得到%
anguler velocity along body的初始值。因%
為$\dot{\phi}(t_{0})$有兩組，因此%
解出的貼體角速度也%
會有兩組，兩組的物%
理意義分別如下，一%
種情況是fast top，這個狀%
況相當於重力的影響%
遠小於總角動量$L$，因%
此這個特別的例子基%
本上相當於忽略重力%
，而陀螺基本上會像%
一個free top一樣進行precession。%
另一種狀況是slow top，也%
就是上面模擬結果中%
第四種的狀況，這裡%
提供的python程式所有情%
況都可以模擬。另外%
一個特殊的情況是在fast
top的情形下，如果初始%
值$\theta _{0}=0$，也就是陀螺z%
軸的起始狀態是垂直%
於水平面的，這樣的%
話陀螺幾乎會像靜止%
不動一樣，我們也叫%
這情況做sleeping top。這些計%
算經典狀況的程式方%
程被包含在setcase()方程裡%
。

\setcounter{page}{1}

\begin{remark}
要陀螺具有Precession and Nutation的%
動作，L/$\Delta L$必須要大，%
如果L小於$\Delta L$，則只會%
有陀螺質量受重力影%
響往下倒下的運動(不%
過這對檢查程式有沒%
有錯誤很有幫助!)，理%
想上L至少要大於$\Delta L$，%
最好L大大於$\Delta L$。化成%
數值上的比較：這代%
表%
\begin{equation}
L\gg \Delta L\Rightarrow I\cdot 2\pi f\gg \vec{\Gamma}\Delta t\Rightarrow
I\cdot 2\pi f\gg \vec{r}\times \vec{F}\cdot 1/f\Rightarrow f\gg \sqrt{\frac{%
arm\cdot Mg\cdot \sin (\theta )}{2\pi I\cdot G}}
\end{equation}%
where $\theta $ is gyro's tilt angle and G is moment of inertial geometry
factor. 考慮$\Delta t$的量級大約%
是陀螺轉幾圈的時間%
(characteristic time)，量級上約是$\sim
1/f$，若假設arm是10 cm, M = 1kg, g=10 m/s$^{2}$%
, I = 0.5M(0.05)$^{2}$,則f最少要10 Hertz以%
上。因此我們將以這%
些參數比較f = 1, 10, 50 Hertz所給%
出的陀螺運動。
\end{remark}

\begin{thebibliography}{99}
\bibitem{goldstein} Herbert Goldstein, \emph{Classical Mechanics}. Addison
Wesley, Massachusetts, 2nd Edition, 1980

\bibitem{tong} David Tong, \emph{Classical Dynamics University of Cambridge
Part II Mathematical Tripos.} Cambridge UK, 2004-2005, (Course note,
available on the web)

\bibitem{matlab} \href{http://www.mathworks.com/help/matlab/ordinary-differential-equations.html%
}{\underline{\color{blue}%
\smash{Matlab online documentation - Ordinary
differential equations.}}}, Matlab R2014a

\bibitem{xu} 徐小明 钟万勰，%
\textit{刚体动力学的四元%
数表示及保辛积分}，%
《应用数学和力学》 2014%
， 35（1）： 111

\bibitem{hasbun} Javier E. Hasbun, \emph{Classical Mechanics with Matlab
Appications.} Jones and Bartlett Publishers, London UK, 2009

\bibitem{titterton} D.H. Titterton and J.L. Weston, \emph{Strapdown Inertial
Navigation Technology}, Peter Peregrinus Ltd., London UK, 1997

\bibitem{pixarnote} David Baraff\textit{, }\href{http://graphics.cs.cmu.edu/courses/15-869-F08/lec/14/notesg.pdf%
}{\underline{\color{blue}%
\smash{Physically Based Modeling - Rigid Body
Simulation}}}, Pixar Animation Studios notes

\bibitem{wolfgangSimMeth} Harvey Gould and Jan Tobochnik and Wolfgang
Christian, \emph{An Introduction to Computer Simulation Methods Third Edition%
}, Addison-Wesley, 2006, \href{http://www.opensourcephysics.org/items/detail.cfm?ID=7375%
}{\underline{\color{blue}\smash{draft available on comPADRE}}}

\bibitem{rapaport} Dennis Rapaport, \emph{The Art of Molecular Dynamics
Simulation 2nd Edition}, Cambridge University Press, 2004

\bibitem{eugene} Eugene Butikov, \href{http://butikov.faculty.ifmo.ru/Applets/Gyroscope.pdf%
}{\underline{\color{blue}\smash{Precession and nutation of a gyroscope}}},
St. Petersburg, Russia, http://butikov.faculty.ifmo.ru/Applets/Gyroscope.pdf

\bibitem{savage} Paul Savage, \emph{Strapdown Inertial Navigation
Integration Algorithm Design Part 1: Attitude Algorithms}, Journal of
Guidance, Control, and Dynamics, Vol. 21, No. 1, January - February 1998

\bibitem{eberly} David Eberly, \emph{Game Physics,} 2nd Edition, CRC Press,
2010
\end{thebibliography}

\bigskip

\null
\vfill

\begin{center}
\rule{6in}{0.01in}
\end{center}

\noindent This document is prepared with Scientific Workplace 5.0 and
typeset with Tex Live 2013 (Xelatex).

\noindent\href{http://whymranderson.blogspot.tw/2014/03/how-to-convert-swp-50-special-unicode.html%
}{\underline{\color{blue}\smash{Blogpost: http://ppt.cc/yS2-}}}

\noindent\href{https://drive.google.com/file/d/0B96HmLH-SQVmM1dvYlFiQm9ESGM/edit?usp=sharing%
}{\underline{\color{blue}%
\smash{Python code:
https://drive.google.com/file/d/0B96HmLH-SQVmM1dvYlFiQm9ESGM/edit?usp=sharing}%
}}

\bigskip

%TCIMACRO{%
%\TeXButton{Include gyrodoc pdf pages}{\includepdf[pages=-]{../../Scripts/GyroDocs/_build/latex/GyroSoftdocumentation.pdf}}}%
%BeginExpansion
\includepdf[pages=-]{../../Scripts/GyroDocs/_build/latex/GyroSoftdocumentation.pdf}%
%EndExpansion

\end{document}
